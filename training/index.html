<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Command Centre REST API training material</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Command Centre REST API training material</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_exclusions">Exclusions</a></li>
</ul>
</li>
<li><a href="#_start_here">Start here</a></li>
<li><a href="#_references">References</a>
<ul class="sectlevel2">
<li><a href="#_developer_api_documentation">Developer API documentation</a></li>
<li><a href="#_api_gateway_technical_paper">API gateway technical paper</a></li>
<li><a href="#_on_the_dvd">On the DVD</a></li>
<li><a href="#_sample_code">Sample code</a></li>
<li><a href="#_abbreviations">Abbreviations</a></li>
</ul>
</li>
<li><a href="#trainingsetup">Training setup</a></li>
<li><a href="#usefulbackground">Useful background</a>
<ul class="sectlevel2">
<li><a href="#_cardholders">Cardholders</a></li>
<li><a href="#_operators_and_operator_groups">Operators and operator groups</a></li>
<li><a href="#_access_groups">Access groups</a></li>
<li><a href="#_personal_data_fields_pdfs">Personal data fields (PDFs)</a></li>
<li><a href="#_divisions">Divisions</a></li>
<li><a href="#_access_zones">Access zones</a></li>
<li><a href="#_roles">Roles</a></li>
<li><a href="#_competencies">Competencies</a></li>
<li><a href="#_card_types">Card types</a></li>
<li><a href="#_all_the_above_are_items">All the above are items</a></li>
<li><a href="#_items_versus_a_cardholders_link_to_them">Items versus a cardholder’s link to them</a></li>
<li><a href="#_events_and_alarms">Events and alarms</a></li>
<li><a href="#_operator_privileges">Operator privileges</a></li>
<li><a href="#httprequests">HTTP requests</a></li>
<li><a href="#_http_responses_codes_and_more_headers_and_bodies">HTTP responses: codes, and more headers and bodies.</a></li>
<li><a href="#_json">JSON</a></li>
<li><a href="#httpscerts">Authentication and encryption certificates</a></li>
</ul>
</li>
<li><a href="#_enable_command_centres_api">Enable Command Centre&#8217;s API</a>
<ul class="sectlevel2">
<li><a href="#_turn_on_the_web_server">Turn on the web server</a></li>
<li><a href="#_installing_a_custom_server_certificate">Installing a custom server certificate</a></li>
<li><a href="#_create_a_rest_operator">Create a REST operator</a></li>
<li><a href="#_create_a_rest_client_item">Create a REST Client item</a></li>
<li><a href="#_what_is_an_api_key">What is an API key?</a></li>
</ul>
</li>
<li><a href="#_try_the_sample_client_application">Try the sample client application</a></li>
<li><a href="#_set_up_chrome">Set up Chrome</a>
<ul class="sectlevel2">
<li><a href="#_install_the_modheader_extension">Install the ModHeader extension</a></li>
<li><a href="#_install_a_json_viewer">Install a JSON viewer</a></li>
<li><a href="#_ignore_server_certificate_warnings">Ignore server certificate warnings</a></li>
</ul>
</li>
<li><a href="#_set_up_postman">Set up Postman</a>
<ul class="sectlevel2">
<li><a href="#_send_the_api_header_with_every_request">Send the API header with every request</a></li>
<li><a href="#_set_the_content_type_to_json">Set the content type to JSON</a></li>
<li><a href="#_never_mind_that_your_server_certificate_is_self_signed">Never mind that your server certificate is self-signed</a></li>
</ul>
</li>
<li><a href="#_first_gets_cardholders">First GETs: cardholders</a>
<ul class="sectlevel2">
<li><a href="#_the_most_basic_get">The most basic GET</a></li>
<li><a href="#_cardholder_summary">Cardholder summary</a></li>
<li><a href="#_hrefs_are_urls_as_well_as_identifiers">Hrefs are URLs as well as identifiers</a></li>
<li><a href="#_cardholder_detail">Cardholder detail</a></li>
</ul>
</li>
<li><a href="#_first_gets_part_two_events">First GETs part two: events</a>
<ul class="sectlevel2">
<li><a href="#_list_all_events">List all events</a></li>
<li><a href="#_list_all_alarms">List all alarms</a></li>
</ul>
</li>
<li><a href="#_back_into_the_theory">Back into the theory</a>
<ul class="sectlevel2">
<li><a href="#_api_controllers">API controllers</a></li>
<li><a href="#_why_we_need_an_operator">Why we need an operator</a></li>
<li><a href="#_the_request_process">The request process</a></li>
</ul>
</li>
<li><a href="#_first_post_and_search">First POST and search</a>
<ul class="sectlevel2">
<li><a href="#_create_a_cardholder">Create a cardholder</a></li>
<li><a href="#_search_for_a_cardholder">Search for a cardholder</a></li>
</ul>
</li>
<li><a href="#_cardholder_flat_fields">Cardholder flat fields</a>
<ul class="sectlevel2">
<li><a href="#_setup_give_a_cardholder_access_groups_and_pdfs">Setup: give a cardholder access groups and PDFs</a></li>
<li><a href="#_change_a_name_authorise_change_simple_pdfs_set_user_code_etc">Change a name, authorise, change simple PDFs, set user code, etc.</a></li>
<li><a href="#_image_pdfs_and_base64">Image PDFs and Base64</a></li>
</ul>
</li>
<li><a href="#_cards">Cards</a>
<ul class="sectlevel2">
<li><a href="#_adding_updating_and_deleting_cards">Adding, updating, and deleting cards</a></li>
<li><a href="#_dont_delete_cards_disable_them">Don’t delete cards: disable them</a></li>
</ul>
</li>
<li><a href="#_group_memberships">Group memberships</a>
<ul class="sectlevel2">
<li><a href="#_add_an_access_group_membership">Add an access group membership</a></li>
<li><a href="#_edit_an_existing_group_membership">Edit an existing group membership</a></li>
</ul>
</li>
<li><a href="#_create_a_cardholder_cont">Create a cardholder, cont.</a></li>
<li><a href="#_coding_considerations">Coding considerations</a>
<ul class="sectlevel2">
<li><a href="#_recap">Recap</a></li>
<li><a href="#_only_one_cardholder_at_a_time">Only one cardholder at a time</a></li>
<li><a href="#_the_importance_of_api">The importance of /api</a></li>
<li><a href="#_identifiers_in_your_app">Identifiers in your app</a></li>
<li><a href="#_do_not_build_your_own_hrefs_from_ids">Do not build your own hrefs from IDs</a></li>
<li><a href="#_sort_by_id_and_get_all_summary_pages_without_delay">Sort by ID, and get all summary pages without delay</a></li>
<li><a href="#_monitoring_for_cardholder_changes_is_much_better_in_8_30">Monitoring for cardholder changes is much better in 8.30</a></li>
<li><a href="#_long_polls">Long polls</a></li>
<li><a href="#_benchmarks">Benchmarks</a></li>
</ul>
</li>
<li><a href="#_advanced_events">Advanced events</a>
<ul class="sectlevel2">
<li><a href="#_event_filters">Event filters</a></li>
<li><a href="#_ids_to_use_in_filters">IDs to use in filters</a></li>
<li><a href="#_filtering_by_date">Filtering by date</a></li>
<li><a href="#_adding_pdf_values_to_the_cardholders_in_events">Adding PDF values to the cardholders in events</a></li>
<li><a href="#_writing_an_interactive_event_viewer">Writing an interactive event viewer</a></li>
<li><a href="#_worked_example_reading_alarms">Worked example: reading alarms</a></li>
</ul>
</li>
<li><a href="#_client_side_certificates">Client-side certificates</a>
<ul class="sectlevel2">
<li><a href="#_what_client_certificate_checking_does">What client certificate checking does</a></li>
<li><a href="#_why_use_client_certificates">Why use client certificates?</a></li>
<li><a href="#_create_a_certificate_and_record_the_thumbprint_in_cc">Create a certificate and record the thumbprint in CC</a></li>
<li><a href="#_use_the_certificate_in_your_client">Use the certificate in your client</a></li>
</ul>
</li>
<li><a href="#_server_side_certificates">Server-side certificates</a>
<ul class="sectlevel2">
<li><a href="#_pin_the_server_certificate_on_the_client">Pin the server certificate on the client</a></li>
<li><a href="#_buy_a_signed_certificate_for_the_server">Buy a signed certificate for the server</a></li>
</ul>
</li>
<li><a href="#_other_command_centre_items">Other Command Centre items</a>
<ul class="sectlevel2">
<li><a href="#_overriding_items">Overriding items</a></li>
<li><a href="#_status_flags">Status flags</a></li>
<li><a href="#_subscribing_to_updates_one_item_at_a_time_pre_8_30_todo">Subscribing to updates (one item at a time, pre-8.30) TODO</a></li>
<li><a href="#_subscribing_to_updates_many_items_8_30_todo">Subscribing to updates (many items, 8.30+) TODO</a></li>
<li><a href="#_schedules_and_day_categories_todo">Schedules and day categories TODO</a></li>
</ul>
</li>
<li><a href="#_visitor_management">Visitor management</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">Introduction</a></li>
<li><a href="#_capabilities_of_the_api">Capabilities of the API</a></li>
<li><a href="#_setting_up_command_centre_to_use_visitor_management_via_the_api">Setting up Command Centre to use Visitor Management via the API</a></li>
</ul>
</li>
<li><a href="#_the_api_gateway">The API gateway</a></li>
<li><a href="#_notes_for_penetration_testers">Notes for penetration testers</a>
<ul class="sectlevel2">
<li><a href="#_item_ids_are_easily_predicted">Item IDs are easily predicted</a></li>
<li><a href="#_there_is_no_rate_limiting_of_authorised_requests">There is no rate-limiting of authorised requests</a></li>
<li><a href="#_the_server_uses_the_host_header">The server uses the Host header</a></li>
</ul>
</li>
<li><a href="#_monitoring_the_api">Monitoring the API</a>
<ul class="sectlevel2">
<li><a href="#_performance_counters">Performance Counters</a></li>
<li><a href="#_access_log">Access log</a></li>
</ul>
</li>
<li><a href="#appendix-privtable">Appendix: Privilege table</a></li>
<li><a href="#appendix-features">Appendix: Features and licences</a>
<ul class="sectlevel2">
<li><a href="#_alarms_and_events">Alarms and events</a></li>
<li><a href="#_cardholders_and_supporting_items">Cardholders and supporting items</a></li>
<li><a href="#_non_cardholder_items">Non-cardholder items</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph lead">
<p>This document is used internally at Gallagher Group to train
developers in the use of Command Centre’s REST API. This version is not yet suitable for
publication, but if you are using the REST API, and like the sound of 60-odd more pages of reading
material, and are tolerant of casual language and a choppy structure meant to help a live speaker
keep the attention of a room of developers, please continue.</p>
</div>
<div class="paragraph">
<p>Also, please contact Gallagher through your channel partner and talk to our Technical Support
Engineers about your project, because we are eager to help you make your integration the best it
can be.</p>
</div>
<h2 id="_disclaimer" class="float">Disclaimer</h2>
<div class="paragraph">
<p>This document gives certain information about products and/or services
provided by Gallagher Group Limited or its related companies (referred
to as "Gallagher Group").</p>
</div>
<div class="paragraph">
<p>The information is indicative only and is subject to change without
notice meaning it may be out of date at any given time. Although every
commercially reasonable effort has been taken to ensure the quality and
accuracy of the information, Gallagher Group makes no representation as
to its accuracy or completeness and it should not be relied on as such.
To the extent permitted by law, all express or implied, or other
representations or warranties in relation to the information are
expressly excluded.</p>
</div>
<div class="paragraph">
<p>Neither Gallagher Group nor any of its directors, employees or other
representatives shall be responsible for any loss that you may incur,
either directly or indirectly, arising from any use or decisions based
on the information provided.</p>
</div>
<div class="paragraph">
<p>Except where stated otherwise, the information is subject to copyright
owned by Gallagher Group and you may not sell it without permission.
Gallagher Group is the owner of all trademarks reproduced in this
information. All trademarks which are not the property of Gallagher
Group, are acknowledged.</p>
</div>
<div class="paragraph">
<p>Copyright © Gallagher Group Ltd 2021. All rights reserved.</p>
</div>
<div class="paragraph">
<p>Gallagher Group Limited<br>
PO Box 3026<br>
Hamilton<br>
New Zealand<br>
+64 (7) 838 9800<br>
E-Mail: <a href="mailto:sales.nz@security.gallagher.com">sales.nz@security.gallagher.com</a><br>
Website: www.gallagher.com</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="link" href="#_introduction">Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph lead">
<p>DRAFT DO NOT DISTRIBUTE.</p>
</div>
<div class="paragraph">
<p>This document is an introduction to using the REST API in Command
Centre, aimed at those involved in the development of software that will
integrate Command Centre into other solutions. It was written to
accompany an informal education session with a Gallagher trainer.</p>
</div>
<div class="paragraph">
<p>It covers features first released in 7.80 and expanded in 7.90.</p>
</div>
<div class="paragraph">
<p>It uses the following styles for guided examples:</p>
</div>
<div class="listingblock">
<div class="title">Sample REST query and the resulting JSON</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">// GET /api </span><span class="w"><b class="conum">(1)</b>
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"a text field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w"> </span><span class="c1">// including comments</span><span class="w">
  </span><span class="nl">"a numeric field"</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span><span class="w">
  </span><span class="nl">"a Boolean field"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Strictly speaking, JSON does not contain comments.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>This style</code> indicates filenames, URLs, and text that benefits from vertical alignment.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Fixed-width blocks are client requests that you can copy out for your own work,
and server responses, pretty-printed a little to make them readable.</pre>
</div>
</div>
<div class="sect2">
<h3 id="_exclusions"><a class="link" href="#_exclusions">Exclusions</a></h3>
<div class="paragraph">
<p>This document does not cover special handling of PIV cards. It shows how
to create a generic card and leaves the variations for PIV and PIV-I to
the developer documentation.</p>
</div>
<div class="paragraph">
<p>Nor does it cover some of the features added after v7.90: access zones,
alarm zones, fence zones, doors, outputs, inputs, PDF definitions,
and macros.  Moving cardholder between access zones, operators, visitors,
schedules, and elevator groups.  Subscribing to cardholder updates, an
efficient way of monitoring large numbers of items, and PII redactions.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_start_here"><a class="link" href="#_start_here">Start here</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Do you want to learn the bare minimum about Command Centre (Gallagher&#8217;s access control product) to
get you started on an integration?  Read <a href="#usefulbackground">Useful background</a>.</p>
</div>
<div class="paragraph">
<p>Do you want to set up Command Centre and try out its API from a REST client?  Read
<a href="#trainingsetup">Training setup</a>.</p>
</div>
<div class="paragraph">
<p>Do you want to learn something about HTTP queries in general?  <a href="#httprequests">HTTP requests</a> will help.</p>
</div>
<div class="paragraph">
<p>Do you need an introduction to how HTTPS uses certificates?
<a href="#httpscerts">Authentication and encryption certificates</a> is for you.</p>
</div>
<div class="paragraph">
<p>Do you want to use client-side certificates to authenticate your client?  Very wise.
<a href="#_client_side_certificates">Client-side certificates</a> has what you need.</p>
</div>
<div class="paragraph">
<p>Are you more concerned about the security of the API?  Look in <a href="#_the_request_process">The request process</a> for how the
server authenticates and authorises requests in general, <a href="#_client_side_certificates">Client-side certificates</a> for how it
can use certificates to authenticate clients, <a href="#_notes_for_penetration_testers">Notes for penetration testers</a> for a mini-FAQ
on pen test findings, and <a href="#_the_api_gateway">The API gateway</a> for deep technical information on the API gateway in the cloud.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references"><a class="link" href="#_references">References</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document refers to API documentation on github and the online help and sample code
on the Command Centre ISO (or DVD, if you have physical media).</p>
</div>
<div class="sect2">
<h3 id="_developer_api_documentation"><a class="link" href="#_developer_api_documentation">Developer API documentation</a></h3>
<div class="paragraph">
<p><a href="https://gallaghersecurity.github.io/" class="bare">https://gallaghersecurity.github.io/</a> holds the reference API
documentation. That is the primary reference for the REST API, so it
aims to be complete, and you should have it on hand whenever developing
against Command Centre. However the amount of detail can be daunting and
it is not very introductory, which is why this document exists.</p>
</div>
<div class="paragraph">
<p>That reference documentation is in four sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cardholders.html</code> describes the cardholder API calls and supporting concepts, such as card types,
access groups, PDFs, roles, and competencies. These functions were new to 7.90. 8.30 added a
cardholder change-tracking API;</p>
</li>
<li>
<p><code>piv.html</code> covers the additional fields you supply and see on PIV and PIV-I cards;</p>
</li>
<li>
<p><code>events.html</code> covers the alarms and events calls. This is all that was available in 7.80. 8.10 added
the ability to create your own events;</p>
</li>
<li>
<p><code>rest.html</code> covers Command Centre items that are not cardholders, alarms, or events: alarm zones,
access zones, fence zones, outputs, doors, and macros arrived in 8.00, and inputs in 8.10. 8.30
added a way to mass-monitor items.  Schedules and elevator groups arrived later still.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We are always improving the content so it is best read online, but if you need an offline copy you
can download a ZIP from <a href="https://github.com/GallagherSecurity/cc-rest-docs" class="bare">https://github.com/GallagherSecurity/cc-rest-docs</a>.  The documentation is no
longer on the Command Centre install media.</p>
</div>
<div class="paragraph">
<p>If running on Windows, something in the mix of Internet Explorer,
Javascript, and <code>file:</code> URLs on network shares prevents the HTML rendering
properly so if those files look goofy to you, try a different browser or
copy the folder to your local drive. Or read it online.</p>
</div>
</div>
<div class="sect2">
<h3 id="_api_gateway_technical_paper"><a class="link" href="#_api_gateway_technical_paper">API gateway technical paper</a></h3>
<div class="paragraph">
<p>If you are thinking of using <a href="#_the_api_gateway">the API gateway</a> this document will get you started, but if you are
after a deeper understanding:</p>
</div>
<div class="paragraph">
<p><a href="https://gallaghersecurity.github.io/docs/Command%20Centre%20Cloud%20Api%20Gateway%20TIP.pdf" class="bare">https://gallaghersecurity.github.io/docs/Command%20Centre%20Cloud%20Api%20Gateway%20TIP.pdf</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_on_the_dvd"><a class="link" href="#_on_the_dvd">On the DVD</a></h3>
<div class="paragraph">
<p>The Configuration Client’s Help menu opens a CHM file that you can also
find in the ISO at
<code>Setup\Program Files\Gallagher\Command Centre\Client\Resources\en</code>
or <code>Setup\Program Files\Gallagher\Command Centre\Bin\Resources\en</code>. There
is a PDF version, split into three volumes, on the ISO in the
Documentation folder.</p>
</div>
<div class="paragraph">
<p>The Command Centre hardening guide, also on the ISO, is required reading
for security-conscious sites. While you may not be able to follow its
leading advice regarding the REST API ("leave it turned off") there is
plenty more in there to be aware of.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sample_code"><a class="link" href="#_sample_code">Sample code</a></h3>
<div class="paragraph">
<p>See <code>Utilities/REST API/REST API Sample Code.zip</code> in the Command Centre
ISO. There is a WPF client in there and a console application in a C#
Visual Studio solution.</p>
</div>
</div>
<div class="sect2">
<h3 id="_abbreviations"><a class="link" href="#_abbreviations">Abbreviations</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">AWS</dt>
<dd>
<p>Amazon&#8217;s cloud.</p>
</dd>
<dt class="hdlist1">CC</dt>
<dd>
<p>Command Centre, Gallagher&#8217;s access control product.</p>
</dd>
<dt class="hdlist1">PDF</dt>
<dd>
<p>Personal Data Field. Not Adobe’s kind. In Gallagher’s defence, these PDFs predate
Adobe’s.</p>
</dd>
<dt class="hdlist1">PII</dt>
<dd>
<p>Personal Identifiable Information.  Any information in Command Centre&#8217;s database concerning a
person, including names, PDFs, movement events, group memberships, roles, competencies, etc.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trainingsetup"><a class="link" href="#trainingsetup">Training setup</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you wish to try the REST API for yourself, you will require:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Command Centre 7.90 or later with a RESTCardholders licence, a RESTEvents licence if you are to
examine events, RESTStatus if you are to look at site items, RESTOverrides if you want to override
them, and RESTCreateEvents if you wish to create events. This document does not cover the last
three.</p>
</li>
<li>
<p>A host capable of reaching port 8904 on Command Centre via HTTPS, or access to the desktop of the
CC server itself.</p>
</li>
<li>
<p>(Recommended) the sample REST client application from the Command Centre installation media (8.10
onward).</p>
</li>
<li>
<p>(Optional) the <a href="https://postman.com">Postman</a> installer, or access to it on the internet.  Any REST
client will do, but this document shows how to set up Postman.</p>
</li>
<li>
<p>(Optional) Chrome and access to the internet for two extensions.  Chrome can be easier to use than
Postman, in some cases.  Again, any web browser will do, but this document shows how to set up
Chrome.</p>
</li>
<li>
<p>(Optional) wget or curl, two command-line utilities commonly found on non-Windows systems.</p>
</li>
<li>
<p>The <a href="../ref">API developer documentation</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="usefulbackground"><a class="link" href="#usefulbackground">Useful background</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains material you should have aboard before reading on.
Skip it if you are familiar with CC.</p>
</div>
<div class="sect2">
<h3 id="_cardholders"><a class="link" href="#_cardholders">Cardholders</a></h3>
<div class="paragraph">
<p>Cardholders are user accounts. Depending on what you give a cardholder
account it can suit different purposes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>people with cards and access needs, but no administrative responsibilities. The REST API allows
management of these kinds of cardholders;</p>
</li>
<li>
<p>administrative people (operators) with all that plus the rights to configure the system and manage its
users. The 8.50 API was the first with features for managing these kinds of cardholders;</p>
</li>
<li>
<p>system accounts with no person associated and no physical access, but administrative access to the
system. You are about to create one of these.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_operators_and_operator_groups"><a class="link" href="#_operators_and_operator_groups">Operators and operator groups</a></h3>
<div class="paragraph">
<p>Operators are cardholders with benefits. Cardholders become operators through
membership of one or more operator groups. An operator group bestows
privileges on its members, including the ability to log in to the
Command Centre thick clients or run REST queries.</p>
</div>
<div class="paragraph">
<p>Operator groups have no effect on access control, so they do not appear in this document again
except when <a href="#_create_a_rest_operator">creating an operator</a> which puts a cardholder in an
operator group while setting up a REST client. Operator groups came to the API in 8.50.</p>
</div>
</div>
<div class="sect2">
<h3 id="_access_groups"><a class="link" href="#_access_groups">Access groups</a></h3>
<div class="paragraph">
<p>Cardholders can be members of any number of <em>access groups</em>. An access
group can be a member of one other:  its parent. Command Centre considers
a member of a group to be a member of all the groups up its parenting
line, as you would expect.</p>
</div>
<div class="paragraph">
<p>A cardholder must be a member of an access group before he or she can
open a door, so every cardholder that represents a person should have
group memberships. (Footnote: there are exceptions of course. Some
visitors, for example, do not need to open doors, but they exist in CC
so that it can record their location as they move around the site with
an escort opening doors for them.)</p>
</div>
<div class="paragraph">
<p>A cardholder can have many memberships of the same group. This is useful
because each has its own start and end times. Past memberships fade
away.</p>
</div>
<div class="paragraph">
<p>Access groups are not operator groups. When this document refers to a
group it means an access group.</p>
</div>
<div class="paragraph">
<p>A cardholder must be a member of an access group before he or she can
have personal data, next.</p>
</div>
</div>
<div class="sect2">
<h3 id="_personal_data_fields_pdfs"><a class="link" href="#_personal_data_fields_pdfs">Personal data fields (PDFs)</a></h3>
<div class="paragraph">
<p>A Personal Data Field adds a custom value to a
cardholder. Each PDF has a type (text, image, numeric, date, telephone
number, email address, …) and optional constraints on the values that it
can hold. For example, text, email, and telephone number types can have
a regular expression attached which a new value must match before
Command Centre will accept it. A date can have a maximum and a minimum.
Text PDFs can have a list of valid values, like an enumeration.</p>
</div>
<div class="paragraph">
<p>There is more configuration: image PDFs have a type and size, to which
Command Centre will transcode incoming images. Mobile numbers and email
addresses have a flag indicating whether they are suitable to receive
SMS and email notifications. All PDFs have their own access level
(hidden, read-only, or full access) that applies to operators in
operator groups that do not expressly override it.</p>
</div>
<div class="paragraph">
<p>Importantly, PDFs are attached to access groups. A cardholder can have a
value for a PDF only if he or she is a member of one of the PDF’s access
groups (Footnote: direct or inherited. Unless otherwise noted, all
Command Centre’s access group membership tests treat inherited members
just like direct members).</p>
</div>
<div class="paragraph">
<p>The REST API allows you to manage a cardholder’s group memberships (so
that he or she has the PDF) as well as see and set PDF values. It does
not let you change the configuration of the PDF itself.</p>
</div>
<div class="paragraph">
<p>Whenever this file or the API&#8217;s reference documentation uses the term 'PDF' it means a personal data
field.</p>
</div>
</div>
<div class="sect2">
<h3 id="_divisions"><a class="link" href="#_divisions">Divisions</a></h3>
<div class="paragraph">
<p>Every item in the API&#8212;&#8203;we will define <em>item</em> in a moment&#8212;&#8203;is in a <em>division</em> (footnote: except day
categories.  They are divisionless). Divisions are arranged in a tree: each has exactly one parent,
aside from the root division, which has none. An operator group specifies the roots of the division
trees to which it grants privileges.</p>
</div>
<div class="paragraph">
<p>Therefore an operator with privileges on the root division has those
privileges on all that server’s objects.</p>
</div>
<div class="paragraph">
<p>Complication: multi-server clusters have one root node (and therefore
one tree of divisions) per server.</p>
</div>
<div class="paragraph">
<p>If you find that an operator cannot see or modify an item, the questions
you should ask are:</p>
</div>
<div class="sect3">
<h4 id="_which_division_is_the_item_in"><a class="link" href="#_which_division_is_the_item_in">Which division is the item in?</a></h4>
<div class="paragraph">
<p>The Command Centre client shows a cardholder’s division in the
'Cardholder Details' pane of the cardholder viewer. The Configuration
Client shows the division of any item in the 'General' tab of its
property page. The REST API shows it in the 'division' field.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<strong>The operator’s division and his or her operator groups' divisions in the 'General' tabs
are irrelevant</strong> to privileges. The operator group grants privileges on the divisions in the
'Divisions' tab.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is a small section on <a href="#_operator_privileges">operator privileges</a> below.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_access_zones"><a class="link" href="#_access_zones">Access zones</a></h3>
<div class="paragraph">
<p>An <em>access zone</em> represents a physical area with Gallagher-controlled doors
on its perimeter.  Something like a room.</p>
</div>
<div class="paragraph">
<p>An access zone can be open or secure.  If open, all its doors are unlocked,
but when it is secure the doors are locked and cardholders attempting entry
will be subject to an access check.</p>
</div>
<div class="paragraph">
<p>Since a real door has a space on each side of it a Command Centre door can
have two zones attached:  an <em>entry</em> zone and an <em>exit</em> zone.  The only
difference between the two is the event that Command Centre creates when
someone badges from one to the other:  'access granted' or 'exit granted'.</p>
</div>
<div class="paragraph">
<p>No matter which way around the zones are attached to a door, when a
cardholder moves through it the resulting event calls the the zone into
which they moved the 'entry' zone, and the one they just left the 'exit'
zone.</p>
</div>
</div>
<div class="sect2">
<h3 id="_roles"><a class="link" href="#_roles">Roles</a></h3>
<div class="paragraph">
<p>A <em>role</em> defines a relationship between two cardholders. One cardholder
can perform a role for many others but can have it performed for them by
only one other. It makes more sense when you use the example
'supervisor': a person has a supervisor and is a supervisor for many
others. When you use REST to look up or update a cardholder, you will
work on the 'has a' relationships, not the 'is a' relationships. In
other words you can change the cardholder’s supervisor, but to change
who the cardholder supervises you need to edit those individuals.</p>
</div>
</div>
<div class="sect2">
<h3 id="_competencies"><a class="link" href="#_competencies">Competencies</a></h3>
<div class="paragraph">
<p>Basically, <em>competencies</em> are another condition that a cardholder must
meet to pass an access check at a door.</p>
</div>
<div class="paragraph">
<p>The REST API lets you manage the links between cardholders and
competencies: create them, delete them, enable/disable them, and set
their expiry dates.</p>
</div>
<div class="paragraph">
<p>You might like to sit down for this part.
A competency can be disabled, expired, both, or neither. Actions at a
door can depend on whether a competency is disabled, expired, soon to
expire, or all good.</p>
</div>
<div class="paragraph">
<p>Whether it is enabled is a flag, plain and simple. Whether it is
expired is derived from an expiry timestamp: if it is
in the past, Command Centre considers the competency expired.</p>
</div>
<div class="paragraph">
<p>A competency can also have an enable date. If that date (timestamp)
passes while the competency is disabled, Command Centre will enable it.</p>
</div>
<div class="paragraph">
<p>If the competency is not disabled, the 'expires' time is important. If
it is in the past, the cardholder’s competency is expired. If it is not
set, or it is in the future, the cardholder benefits from the
competency.</p>
</div>
<div class="paragraph">
<p>A cardholder can have only one link to each competency.  They differ from access groups in that way.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Enabled flag</th>
<th class="tableblock halign-left valign-top">Enablement date</th>
<th class="tableblock halign-left valign-top">Expiry date</th>
<th class="tableblock halign-left valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Far future</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Near future</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active (with a warning at the door)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Past</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inactive (expired)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Future</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inactive (pending)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Past</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inactive (disabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inactive (disabled)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_card_types"><a class="link" href="#_card_types">Card types</a></h3>
<div class="paragraph">
<p>A card type carries rules for the data that a card carries, PINs, how to
treat cards around their expiry time, and default values for new cards
of that type. We often use the word "credential" because not all card
types involve a physical card: there are also biometric and mobile card
types.</p>
</div>
<div class="paragraph">
<p>The REST API provides read access to card types so that you can manage
cardholders’ credentials.</p>
</div>
<div class="paragraph">
<p>PIV cards have their own developer document, separate from the rest of
the cardholder API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_all_the_above_are_items"><a class="link" href="#_all_the_above_are_items">All the above are items</a></h3>
<div class="paragraph">
<p>The API lets you search for items and examine them, but&#8212;&#8203;other than
cardholders and schedules&#8212;&#8203;it does not let create, alter, or delete them.
The purpose of the cardholder API is to let you associate items with
cardholders and manage those associations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_items_versus_a_cardholders_link_to_them"><a class="link" href="#_items_versus_a_cardholders_link_to_them">Items versus a cardholder’s link to them</a></h3>
<div class="paragraph">
<p>Talking about a PDF or a competency can be confusing, because there is a
PDF item and a competency item, and cardholders can have PDFs and
competencies, but the item and the cardholder’s link to the item are
different things.</p>
</div>
<div class="paragraph">
<p>The items (on the left in the table below) and the connection to a
cardholder (on the right) both appear in the REST API, but the API only
lets you change the things in the right column, the connections.
So let
us make some definitions:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Item</th>
<th class="tableblock halign-left valign-top">A cardholder’s possession of that item</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group membership</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Competency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cardholder competency</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relationship<br>
(the role is the nature of the relationship between two cardholders)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Locker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Locker assignment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cardholder PDF<br>
or<br>
PDF value</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There is a question of scale. You may have only two competencies, but thousands of cardholders with
those competencies. You may have only one role in the system, but every one of your cardholders
might have a relationship using that role.</p>
</div>
<div class="paragraph">
<p>For that reason, the API calls that list items such as roles and competencies do not list their
connections to cardholders. The result sets would be too large. Instead,
you see those connections from the cardholder side: when you GET a
cardholder’s details, you will see all the connections that cardholder
has to PDFs, competencies, groups, cards, lockers, and roles.</p>
</div>
<div class="paragraph">
<p>Access groups and operator groups will show you their cardholder
members, but only if you ask.</p>
</div>
</div>
<div class="sect2">
<h3 id="_events_and_alarms"><a class="link" href="#_events_and_alarms">Events and alarms</a></h3>
<div class="paragraph">
<p>Events record occurrences in the system. They are not items. They have
an ID, a source item, an occurrence time, and links to other related
items. Events are immutable: the events you read from the REST API will
not change.</p>
</div>
<div class="paragraph">
<p>Alarms are events with extra fields, and some of them are mutable: there
is a free-text notes field that you can edit in the thick clients, a
history, and Booleans recording whether the alarm is acknowledged,
processed, and active.</p>
</div>
<div class="paragraph">
<p>The alarms interface only shows unprocessed alarms in its search
results. Once an operator processes an alarm, it disappears from alarm
searches. However, the alarm still exists in the database and an alarm
is also an event, so the events interface will return it whether
somebody processed it or not.</p>
</div>
</div>
<div class="sect2">
<h3 id="_operator_privileges"><a class="link" href="#_operator_privileges">Operator privileges</a></h3>
<div class="paragraph">
<p>Or just 'privileges' since there is no other kind.</p>
</div>
<div class="paragraph">
<p>An operator has privileges over a division and all its subdivisions.
When we refer to an operator having a privilege on a cardholder, for
example, we mean that the operator has that privilege on the
cardholder’s division, or one of its ancestor divisions.</p>
</div>
<div class="paragraph">
<p>In the interests of security, you should give your REST operators
(footnote: <em>all</em> operators) the minimum privileges they require to
achieve their task.</p>
</div>
<div class="paragraph">
<p><a href="#appendix-privtable">Appendix: Privilege table</a> gives examples of privileges you will need for various tasks.</p>
</div>
</div>
<div class="sect2">
<h3 id="httprequests"><a class="link" href="#httprequests">HTTP requests</a></h3>
<div class="paragraph">
<p>An HTTP request has four parts: a verb, an address, a handful of
headers, and a body.</p>
</div>
<div class="sect3">
<h4 id="_verbs"><a class="link" href="#_verbs">Verbs</a></h4>
<div class="paragraph">
<p>The verbs we will use are GET, POST, PATCH, and DELETE (in upper case by
convention). GET and DELETE are self-explanatory but the other two are
often confused. In this API we use POST to create something new such as
a cardholder, and PATCH to modify something like the end-date on a group
membership.</p>
</div>
</div>
<div class="sect3">
<h4 id="_addresses_urls"><a class="link" href="#_addresses_urls">Addresses (URLs)</a></h4>
<div class="paragraph">
<p>The address is the URL that everyone is accustomed to. In a REST API the
address identifies the object you wish to GET, PATCH, or DELETE. When
POSTing, the address identifies the type of thing you wish to create.</p>
</div>
</div>
<div class="sect3">
<h4 id="_headers"><a class="link" href="#_headers">Headers</a></h4>
<div class="paragraph">
<p>Headers are a list of key/value pairs. We use one called Authorization
(spelled with a Z) to carry client authentication, and one called
Content-Type to be clear that we use JSON.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bodies"><a class="link" href="#_bodies">Bodies</a></h4>
<div class="paragraph">
<p>The body of a GET or DELETE request is empty. A POST can also be empty,
but they usually carry some instructions for what you want created. A
PATCH always needs a body that contains instructions for how to modify
the item identified by the address.</p>
</div>
<div class="paragraph">
<p>If the body is not empty, it must contain JSON (below).</p>
</div>
<div class="paragraph">
<p>The sample application "CCFT REST Client" opens a console window that
shows you the verb and address of the HTTP queries it is making. It can
also show you the bodies of its queries and the server’s responses.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http_responses_codes_and_more_headers_and_bodies"><a class="link" href="#_http_responses_codes_and_more_headers_and_bodies">HTTP responses: codes, and more headers and bodies.</a></h3>
<div class="paragraph">
<p>An HTTP response has three parts: a numeric response code, more headers,
and a body.</p>
</div>
<div class="sect3">
<h4 id="_response_codes"><a class="link" href="#_response_codes">Response codes</a></h4>
<div class="paragraph">
<p>Any response in the 200-299 range means success. GETs return a 200 along
with their results. DELETEs and MODIFYs return 204 ("no content"),
which just means they succeeded and having nothing more to say. Creating
a cardholder or event returns 201 ("created").</p>
</div>
<div class="paragraph">
<p>A response in the 400-499 range generally means there was something
wrong with the request. One exception is 409: it could mean that your
timing was bad and trying again later may succeed. Along with 403 and 404, 409
could also mean you have attempted to do something beyond your
privilege. 401 means you did not sent a good Authorization header and
the server does not trust you at all.
The body of the response that comes back from the server will
tell you the problem.</p>
</div>
<div class="paragraph">
<p>500-level responses mean the server has met with trouble. Waiting for
updates on events or items is an exception: if you ask Command Centre
for updates and none arrives before the timeout, it will return 503.
That is actually a kind of success: it means nothing changed while you
were waiting, so a future version of Command Centre may return a
200-level code in this case.</p>
</div>
</div>
<div class="sect3">
<h4 id="_headers_2"><a class="link" href="#_headers_2">Headers</a></h4>
<div class="paragraph">
<p>The only time Command Centre returns a header of interest is after it
processes a POST to create a cardholder or event. It sets a header
called Location containing the URL of your new object.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bodies_2"><a class="link" href="#_bodies_2">Bodies</a></h4>
<div class="paragraph">
<p>The body of a GET response contains everything you asked for, in JSON.
The body that comes back from other verbs is empty unless there was a
problem.</p>
</div>
<div class="paragraph">
<p>Chrome will show you the body. Press F12 and resend the request to make
Chrome show you the response code and the headers as well (along with
lots of other useful information). Postman (a web client we will get to
later) always shows you everything.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_json"><a class="link" href="#_json">JSON</a></h3>
<div class="paragraph">
<p>&#8230;&#8203;though familiarity with XML or any programming language should be
enough. With line breaks and indentation and a bit of colour, JSON is
quite readable.</p>
</div>
<div class="paragraph">
<p>JSON can contain flat fields, objects (structures), and arrays.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="p">{</span><span class="w">
  </span><span class="nl">"a text field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"a numeric field"</span><span class="p">:</span><span class="w"> </span><span class="mi">1234</span><span class="p">,</span><span class="w">
  </span><span class="nl">"a Boolean field"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nl">"an object"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"sub-field1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"sub-field2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"an array"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"sub-field1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jingle"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"sub-field2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bells"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"sub-field1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"sub-field2"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bar"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In that example, the array called <code>an array</code> shows an array containing two
more objects, each of which contains two fields of its own.</p>
</div>
</div>
<div class="sect2">
<h3 id="httpscerts"><a class="link" href="#httpscerts">Authentication and encryption certificates</a></h3>
<div class="paragraph">
<p>Before an API call can succeed the client needs to decide to trust the
server and then the server needs to decide to trust the client. They do
that using <em>certificates</em>.</p>
</div>
<div class="paragraph">
<p>First a little background. Very simply put, the current algorithms for
secure communication require a pair of <em>keys</em>. Keys are nothing more
than huge numbers. The two in the pair are different from each other,
but mathematically related so that when you encrypt some data using one
key, nobody can decrypt it if they do not have the other key. The key used for
encryption is public because there is no harm in encrypting data.
People toss those keys around like business cards. Its mate, however,
is very, very private, because it is the one that unlocks the secret message.</p>
</div>
<div class="paragraph">
<p>These keys do more than just encrypt
and decrypt data so we do not use those terms in their names.  The business
card one is called the <em>public key</em> and the other is
the <em>private key</em>.</p>
</div>
<div class="paragraph">
<p>A <em>certificate</em> contains a public key plus metadata: what the key is
meant for, how long it is good for, and some proof that it is authentic,
if there is any. That proof of authenticity takes the form of a
signature from an authority that the internet has agreed to trust, such
as Symantec or Verizon. Client certificates, and some server
certificates, do not have a signature. Or they do, but it is their own
signature, which does not really count because nobody trusts it. Such
certificates are called <em>self-signed</em>. Web browsers cook up their own
self-signed certificates all the time. Web server certificates, on the
other hand, last for months or years.</p>
</div>
<div class="paragraph">
<p>If an HTTPS client and server connect and establish an encrypted channel
of communication without checking certificates, it will be secret (nobody
will be able to listen in)
but they should not trust each other. The other end could be
fibbing. So they conduct a negotiation to establish each other’s
identity (i.e., they <em>authenticate</em>).</p>
</div>
<div class="paragraph">
<p>Usually a web client requires proof of authenticity from the server,
since you want to be sure that it really is your bank’s web site you are
looking at and not a fake. If the server does not provide that, the
client shows a warning. When working with the Command Centre API you
will have to <a href="#_ignore_server_certificate_warnings">work around it in
Chrome</a> and
<a href="#_never_mind_that_your_server_certificate_is_self_signed">work around
it in Postman</a>. If you want to install your own server key, the topic
'Changing the Web Services' in the Configuration Client’s online help
shows you how.</p>
</div>
<div class="paragraph">
<p>Sometimes the server also requires a proof of identity from the client.
This does not happen when using most web sites because (continuing the
bank example) your bank does not care where you are coming from.
It uses your password to authenticate you.  But APIs should operate more
securely than web sites so our recommendation is to turn on the feature
that makes the server check your clients' certificates.
<a href="#_client_side_certificates">Client-side certificates</a> covers client
certificates.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<strong>Know the difference between the two certificate checks, and that they are completely
independent</strong>. If the client drops a connection because it does not trust the server, Command Centre
cannot raise any alarms, because it never received a proper connection. The problem is on the client
and there is nothing you can do to Command Centre to help. But if the server certificate is
acceptable to the client, the server has a chance to check the client certificate.  If the server
does not like the client certificate, Command Centre will raise an 'invalid client certificate'
alarm.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_enable_command_centres_api"><a class="link" href="#_enable_command_centres_api">Enable Command Centre&#8217;s API</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_turn_on_the_web_server"><a class="link" href="#_turn_on_the_web_server">Turn on the web server</a></h3>
<div class="paragraph">
<p>Configuration client &#8594; File &#8594; Server Properties &#8594; Web Services (about 15 down).</p>
</div>
<div class="paragraph">
<p>Enable the REST API and–-for the moment–-tick the checkbox to the right of the port. This is an old
screenshot:  it changed labels in 8.50. Have a good look at the status because if your server has a
problem binding a socket (which just means "listening"), it will show here first.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/server_props_turnon.png" alt="Enabling the public API">
</div>
<div class="title">Figure 1. Enabling the web server</div>
</div>
<div class="paragraph">
<p>The Configuration Client’s online help covers this in the topic called
'Web Services'.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
⚠ <strong>Make sure 'Do not require pinned client certificates' is off in production</strong>. In 8.50 it
changed its name to 'Enable REST Clients with no client certificate'. It ships turned off: make sure
it stays off on production servers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Requiring pre-shared certificates from clients is the best protection
the server has against attackers on its network. If you tick the box to
turn off that check when you first start your development, come back
once your application is connecting successfully and untick it again.
Read <a href="#_client_side_certificates">Client-side certificates</a> to help get your application connecting again
after doing that.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_a_custom_server_certificate"><a class="link" href="#_installing_a_custom_server_certificate">Installing a custom server certificate</a></h3>
<div class="paragraph">
<p>You do not need to install a custom server certificate for experimental development. If you
eventually choose to do it, it all happens under a button that arrived in Command Centre after I
took the screenshot above, labelled 'Manage Certificates'. The Configuration Client’s online help
covers it in detail in a section called 'Replacing the web service certificate' in the 'Changing the
Web Services' topic. You can either import a public/private key pair into Command Centre (which is
simple, secure, and recommended) or use the Windows Certificate Store (which uses Microsoft’s
security instead of Command Centre’s). The summary of the Certificate Store process is: you need to
name your certificate 'Gallagher Command Centre Server' (please take care with the spelling), place
it in the 'Gallagher Applications / Certificates' folder of the Local Computer Certificate Store,
and give Command Centre the rights to use it. The online help lays that out step by step.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_rest_operator"><a class="link" href="#_create_a_rest_operator">Create a REST operator</a></h3>
<div class="paragraph">
<p>We will get to the reasons why in <a href="#_why_we_need_an_operator">Why we need an operator</a>.</p>
</div>
<div class="sect3">
<h4 id="_create_an_operator_group_and_give_it_the_necessary_privileges"><a class="link" href="#_create_an_operator_group_and_give_it_the_necessary_privileges">Create an operator group and give it the necessary privileges</a></h4>
<div class="paragraph">
<p>You can do this in either the operational client ("Command Centre") or the configuration client.</p>
</div>
<div class="paragraph">
<p>Give the group the lowest level privileges it needs. For this exercise,
you will need 'Create and Edit Cardholders' and 'Edit Alarms'. 'Modify
Access Control' and 'View Site' could be handy later.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/op_group_privs.png" alt="Adding privs to an operator group">
</div>
<div class="title">Figure 2. Adding privs to an op group</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Not 'Advanced User'. Never 'Advanced User'.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="#appendix-privtable">this appendix</a> for a table of
privileges an operator needs for common tasks.</p>
</div>
<div class="paragraph">
<p>One group is enough for experimenting but when it comes to production,
create an operator group for each class of client you have connecting
and give each group different privileges. An operator can be in more
than one operator group; use this flexibility as you need.</p>
</div>
</div>
<div class="sect3">
<h4 id="_create_a_cardholder_and_add_it_to_the_operator_group"><a class="link" href="#_create_a_cardholder_and_add_it_to_the_operator_group">Create a cardholder and add it to the operator group</a></h4>
<div class="paragraph">
<p>You can do this in either of the clients.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/op_group_members.png" alt="Adding cardholders to an op group">
</div>
<div class="title">Figure 3. Adding cardholders to an op group</div>
</div>
<div class="paragraph">
<p>In production, your operator should have a bare minimum of
capabilities, so do not give it a card, logon, password, or user code.
Do give it plenty of description about what it does, where it connects
from, and who to contact about it, because the people running the
security system will not be the people who run your software
integrations and they will need all the help you can give them when
problems arise.</p>
</div>
<div class="paragraph">
<p>During development it helps to log in to the Command Centre clients
sometimes, so I give the REST operator a logon, password, and the
'Launch Configuration Client' privilege.</p>
</div>
<div class="paragraph">
<p>Now that you have an operator, you need to let the REST API use it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_rest_client_item"><a class="link" href="#_create_a_rest_client_item">Create a REST Client item</a></h3>
<div class="paragraph">
<p>…(in the server) and assign an operator.</p>
</div>
<div class="paragraph">
<p>We call it a 'REST Client' but it is really a mapping from an API key
to an operator. More on this later.</p>
</div>
<div class="paragraph">
<p>Using the Configuration client, Configure &#8594; Services and Workstations
(at the bottom). Right-click menu &#8594; New &#8594; REST&#160;Client.</p>
</div>
<div class="paragraph">
<p>Set a name, then go to the 'API Key' tab.</p>
</div>
<div class="paragraph">
<p>Drag your new operator (Manage &#8594; Cardholders) into the 'REST Client
Operator' box. That box looks like it can hold more than one: it cannot.</p>
</div>
<div class="paragraph">
<p>Take a note of the API key. You will need it for your clients (the
sample app, Chrome, or Postman).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/rest_client_api_key.png" alt="A REST Client item&#8217;s API key in the Configuration Client">
</div>
<div class="title">Figure 4. A REST Client item&#8217;s API key in the Configuration Client</div>
</div>
<div class="paragraph">
<p>IP filtering is a layer of security that makes it that much harder for
an attacker to attack your server.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/rest_client_ip_filtering.png" alt="A REST Client&#8217;s IP filters in the Configuration Client">
</div>
<div class="title">Figure 5. A REST Client&#8217;s IP filters in the Configuration Client</div>
</div>
<div class="paragraph">
<p>(A space is as good as a comma.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_an_api_key"><a class="link" href="#_what_is_an_api_key">What is an API key?</a></h3>
<div class="paragraph">
<p>Your client sends this to Command Centre with every request. It is the
username and password combined. Take care of it. If someone steals your
API key and you have not taken other precautions (client certificates
and IP filtering) they could masquerade as you.</p>
</div>
<div class="paragraph">
<p>If something makes an API call without an API key, or with an API key
that Command Centre cannot find on one of the REST Client items, CC will
raise an error 'A REST connection was attempted with an invalid API
key'.</p>
</div>
<div class="paragraph">
<p>When a client sends it to the server in an HTTP header it prepends
<code>GGL-API-KEY</code> and a space. That string is not part of the key and you
should not use it in any of the places that expect an API key. It is
just there so the HTTP request conforms to an Internet standard.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_try_the_sample_client_application"><a class="link" href="#_try_the_sample_client_application">Try the sample client application</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section needs fleshing out with proper prose, but until that
happens the major points to cover are:</p>
</div>
<div class="paragraph">
<p>The sample client is the quickest way to make sure CC is working
properly. For Windows users, it is better than a web browser (which
requires plugins and hides error messages) or Postman (which is fiddly
if the server is checking client certificates).</p>
</div>
<div class="paragraph">
<p>Find the sample client on the installation media under Utilities / REST
API / RESTClient_version. It has been there since 8.00.</p>
</div>
<div class="paragraph">
<p>It is not a Command Centre management application! It is a library of
sample code for developers, which happens to compile and run. You can
check the status of many items, override most of them, watch and create
events, and create, look up, and move cardholders, but some features
like lockers and car parks are missing.</p>
</div>
<div class="paragraph">
<p>Watch the multi-coloured console to find out what URLs to use in your
own requests. Later versions include options on the login screen to also
show the JSON that the client is sending and receiving.</p>
</div>
<div class="paragraph">
<p>The source code for the demo app and a few others is on the installation
media.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_set_up_chrome"><a class="link" href="#_set_up_chrome">Set up Chrome</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If the sample GUI app works and you want to see the data that comes from
Command Centre, a web browser is all you need. If you also want to
create and change items you should skip this section and install
Postman.</p>
</div>
<div class="paragraph">
<p>There are two extensions you need to install for Chrome to be really
useful. One sends the API key to the server, and the other dresses up
the JSON that it sends back.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Since writing this, several browser extensions have appeared that test REST APIs quite
thoroughly.  They may provide a better experience.  Shop around.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_install_the_modheader_extension"><a class="link" href="#_install_the_modheader_extension">Install the ModHeader extension</a></h3>
<div class="paragraph">
<p>You need to set a custom header, because that is how we send the API key
and without that Command Centre will give you nothing.</p>
</div>
<div class="paragraph">
<p>Start by clicking the 'Modify Headers' icon in Chrome. (Footnote:
confusingly, there is also an extension called 'Modify Headers', which
is different from 'ModHeader'. Use either.)</p>
</div>
<div class="paragraph">
<p>Set a header called Authorization with a value of <code>GGL-API-KEY</code> followed
by a space and the API key you took from the configuration client. Note
in the example below I have two headers ready to go, only one of which
is active. They are too wide for the Modify Headers window (there are
three more characters).</p>
</div>
<div class="paragraph">
<p>In 7.90, both must be in upper case.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
⚠ <strong>Set a filter so that the header only goes to your Command Centre
server. Otherwise Facebook will have your API key</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use a URL pattern in the filter that all your queries will match but
other web browsing will not. ModHeader now uses regular expressions, so
if you have dots in your hostname you must put backslashes in front,
<code>\.</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/chrome_mod_header_setup.png" alt="Configure Mod Header Chrome extension">
</div>
<div class="title">Figure 6. Configure Mod Header Chrome extension</div>
</div>
</div>
<div class="sect2">
<h3 id="_install_a_json_viewer"><a class="link" href="#_install_a_json_viewer">Install a JSON viewer</a></h3>
<div class="paragraph">
<p>Raw JSON straight from the server contains no whitespace, so it is not
that easy to read. There are a few Chrome extensions that pretty-print
JSON for you. I use 'Awesome JSON Viewer' because it is recent (April
2020) and can collapse and count sub-items. It is rebranding itself
'JSON Viewer Pro', so you might try searching for that. Despite having
'pro' in the name it remains free.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ignore_server_certificate_warnings"><a class="link" href="#_ignore_server_certificate_warnings">Ignore server certificate warnings</a></h3>
<div class="paragraph">
<p>Send Chrome to <code><a href="https://yourhost:yourport/" class="bare">https://yourhost:yourport/</a></code>.  <code>yourport</code> will be 8904 unless you changed it when
you <a href="#_turn_on_the_web_server">set up the web server</a>. If your server does not have a certificate
with a trust path to a trusted root certificate, you need to click through the warning below.  It
will reappear occasionally. You can turn it off in Chrome but it is not a good idea, since you want
to know when other servers are using self-signed certificates.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/chrome_bad_server_cert_1.png" alt="Chrome fretting about a server cert">
</div>
<div class="title">Figure 7. Chrome fretting about a server cert</div>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/chrome_bad_server_cert_2.png" alt="Chrome fretting in more detail" height="]">
</div>
<div class="title">Figure 8. Chrome fretting in more detail</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_set_up_postman"><a class="link" href="#_set_up_postman">Set up Postman</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to do more than look, you need Postman, because Chrome does
not let you POST, PATCH, or DELETE as easily as Postman does.</p>
</div>
<div class="paragraph">
<p>Postman used to be a Chrome extension but is now a standalone
application. Both work. These screenshots are from the application.</p>
</div>
<div class="sect2">
<h3 id="_send_the_api_header_with_every_request"><a class="link" href="#_send_the_api_header_with_every_request">Send the API header with every request</a></h3>
<div class="paragraph">
<p>This is what the Modify Headers extension does in Chrome. It makes
Postman send an Authorization header containing your API key with every
request.</p>
</div>
<div class="paragraph">
<p>Your requests also need a Content-Type header but you do not need to set
it yourself. Postman will add that after the next step.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/postman_auth_header.png" alt="Setting auth header in Postman">
</div>
<div class="title">Figure 9. Setting auth header in Postman</div>
</div>
<div class="paragraph">
<p><strong>There is a mistake in that screenshot</strong>: the value for the Authorization
header should have <code>GGL-API-KEY</code> and a space before the API key.  Later versions of Command Centre
will not work without it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_set_the_content_type_to_json"><a class="link" href="#_set_the_content_type_to_json">Set the content type to JSON</a></h3>
<div class="paragraph">
<p>Otherwise Command Centre will reject it as invalid.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/postman_content_type.png" alt="Content-type Postman header">
</div>
<div class="title">Figure 10. Content-type Postman header</div>
</div>
<div class="paragraph">
<p>You must use <code>application/json</code>, in lower case, nothing more. People
have tried adding a semicolon and <code>charset=utf8</code>, but that just stops
all queries from working.</p>
</div>
</div>
<div class="sect2">
<h3 id="_never_mind_that_your_server_certificate_is_self_signed"><a class="link" href="#_never_mind_that_your_server_certificate_is_self_signed">Never mind that your server certificate is self-signed</a></h3>
<div class="paragraph">
<p>In the current version of Postman, the settings are behind the cog in
the top tool bar, not the sliders in the environment toolbar below it.</p>
</div>
<div class="paragraph">
<p>For older versions of Postman, the settings are behind the open-ended
wrench in the top tool bar, not the cog in the environment toolbar below
it.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/postman_server_cert_warning_off_1.png" alt="Postman settings menu">
</div>
<div class="title">Figure 11. Postman settings menu</div>
</div>
<div class="paragraph">
<p>Pick 'Settings' and turn off SSL certificate verification. Turn off the
other options if you want to keep it looking clean. It makes no
difference to Command Centre.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/postman_server_cert_warning_off_2.png" alt="Postman SSL cert verification off">
</div>
<div class="title">Figure 12. Postman SSL cert verification off</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_first_gets_cardholders"><a class="link" href="#_first_gets_cardholders">First GETs: cardholders</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_the_most_basic_get"><a class="link" href="#_the_most_basic_get">The most basic GET</a></h3>
<div class="paragraph">
<p>Using Chrome, go to <a href="https://yourserver:8904/api" class="bare">https://yourserver:8904/api</a> again. This document
and the developer documentation use the following shorthand for that instruction, which omits
the protocol, host, and port:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api</pre>
</div>
</div>
<div class="paragraph">
<p>Doing that will test everything you have set up so far. If it did not
work, look at the error message in the response body (Chrome will show
it) and the most recent events in Command Centre.</p>
</div>
<div class="paragraph">
<p>If it did accept your API key, the only thing that can stop you now is a
licensing problem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="p">{</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"feature not licensed"</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With a RESTEvents licence you will get more:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7.90.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"features"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"alarms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With a RESTCardholdersEvents licence:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7.90.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"features"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"alarms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"cardholders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"accessGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"roles"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"lockerBanks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"competencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"cardTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="c1">...</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is not the exact JSON you will get (that is not even JSON) but hopefully
you get the idea.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cardholder_summary"><a class="link" href="#_cardholder_summary">Cardholder summary</a></h3>
<div class="literalblock">
<div class="content">
<pre>GET /api/cardholders</pre>
</div>
</div>
<div class="paragraph">
<p>That means you should Chrome or Postman to <code><a href="https://yourhost:yourport/api/cardholders" class="bare">https://yourhost:yourport/api/cardholders</a></code>.</p>
</div>
<div class="paragraph">
<p>Your operator should be there. Try following some of the links. If you
are using Chrome, just click on them.</p>
</div>
<div class="paragraph">
<p>One of the links called <code>href</code> (probably the first one) will take you to a cardholder&#8217;s <em>details</em>
page, covered in the next section.</p>
</div>
<div class="paragraph">
<p>Next try:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/cardholders?top=1</pre>
</div>
</div>
<div class="paragraph">
<p>That limits the results to one cardholder. If you don’t have a <code>next</code>
link in the result, it will be because there is only one cardholder in
your system or your operator only has access to one.</p>
</div>
<div class="paragraph">
<p>Now apply the advice from the efficiency section of the developer
documentation for collecting a lot of cardholders at once:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/cardholders?sort=id&amp;top=10000</pre>
</div>
</div>
<div class="paragraph">
<p>v8.00 delivered the ability to add all the fields from the details page
to the summary page, using the <code>fields</code> parameter. See the developer
documentation for a proper description, but in short, try adding
<code>fields=<em>fieldname</em></code> to your request URL (after a <code>?</code> or <code>&amp;</code> of course)
where <em>fieldname</em> is the name of a field you can see in a details page,
such as <code>cards</code> or <code>accessGroups</code>. For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/cardholders?sort=id&amp;top=10000&amp;fields=firstName,lastName,cards</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hrefs_are_urls_as_well_as_identifiers"><a class="link" href="#_hrefs_are_urls_as_well_as_identifiers">Hrefs are URLs as well as identifiers</a></h3>
<div class="paragraph">
<p>The fields called <code>href</code> in the cardholder summary are URLs,
and hopefully you have followed one already. Some will return you a page
of data, and some will 404. We call them <em>hrefs</em> rather than URLs
because they are HTML references that, in our case, happen to be HTTPS
URLs.</p>
</div>
<div class="paragraph">
<p>Hrefs are very important. Each object in Command Centre&#8212;&#8203;events,
alarms, items, connections between them&#8212;&#8203;has one that identifies it.
You will be sending many of them in the bodies of your requests.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cardholder_detail"><a class="link" href="#_cardholder_detail">Cardholder detail</a></h3>
<div class="paragraph">
<p>Follow one of the href links on the summary page:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/cardholders/1234</pre>
</div>
</div>
<div class="paragraph">
<p>1234 will be a different number on your system. The API documentation
uses the syntax <code>/api/cardholders/{id}</code>. Ignore the braces! There are no
braces in our URLs.</p>
</div>
<div class="paragraph">
<p>That GET shows you everything the REST API can tell you about the
cardholder (footnote: not quite everything. Mobile credentials and PIV
and PIV-I cards have blobs of data that do not come out unless you ask
for them, because they are so large). The developer documentation helps
interpret it.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>The differences between a summary page and a detail page are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A summary page is a search.  You pass it search filters, an item limit, and sorting and pagination
instructions and it will return any number of items.  A detail page will only tell you about one.</p>
</li>
<li>
<p>A detail page will return more fields than a summary page, by default.  However you should tell
both to only return the fields you need.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The API documentation makes heavy use of the terms <em>summary</em> and
<em>detail</em>. You see the summary of an item at root URLs such as
<code>/api/cardholders</code> and <code>/api/access_groups</code>, returned in an array of
many items of the same type as the results of a search. You see the
detail of a lone item by following the item’s href.</p>
</div>
<div class="paragraph">
<p>It worth becoming familiar with the structure of a cardholder in JSON
because the REST API uses it for summary and detail pages, and it
expects very nearly the same structure when you create or modify a
cardholder. They vary in the quantity of fields and their levels in the
document.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_first_gets_part_two_events"><a class="link" href="#_first_gets_part_two_events">First GETs part two: events</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_list_all_events"><a class="link" href="#_list_all_events">List all events</a></h3>
<div class="paragraph">
<p>This returns 1000, starting with the first recorded:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/events</pre>
</div>
</div>
<div class="paragraph">
<p>If it takes a while, it is because the JSON viewer extension in Chrome
is pretty-printing it.</p>
</div>
<div class="paragraph">
<p>From there you can following the <code>next</code> link to get another thousand.
When you have extracted all the events out of Command Centre, an
<code>updates</code> link will replace <code>next</code>. The <code>updates</code> URL is a long poll
link: GETting it will block until more events arrive, or the call times
out.</p>
</div>
<div class="paragraph">
<p>If you are writing a program that will extract all events out of Command
Centre you should set <code>top</code> (described in the API documentation) as high
as you can. Command Centre will cap it at 10,000. You do not gain much
performance after a couple of thousand, but taking it higher reduces the
number of requests.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/events?top=5000</pre>
</div>
</div>
<div class="paragraph">
<p>It might take a while for the JSON viewer to render all that JSON.</p>
</div>
</div>
<div class="sect2">
<h3 id="_list_all_alarms"><a class="link" href="#_list_all_alarms">List all alarms</a></h3>
<div class="paragraph">
<p>The alarms interface only returns alarms that have not been processed,
i.e., those that are 'current'. After an operator processes an alarm, it
is merely an event with extra fields.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/alarms</pre>
</div>
</div>
<div class="paragraph">
<p>That will return at most 100 alarms. You can follow the <code>next</code> link to
get more, until you have got them all and an <code>updates</code> link replaces it.
The <code>updates</code> URL is a long poll: GETting it will block until more
alarms occur or the call times out.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_back_into_the_theory"><a class="link" href="#_back_into_the_theory">Back into the theory</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section is a grab-bag of facts you need before going further.</p>
</div>
<div class="sect2">
<h3 id="_api_controllers"><a class="link" href="#_api_controllers">API controllers</a></h3>
<div class="paragraph">
<p><em>Controllers</em> are different parts of the REST API. Not to be confused
with the controller hardware Gallagher also produces, API controllers
have the same name as the part of the request URL after the leading
<code>/api</code>. The main ones are <code>alarms</code>, <code>events</code>, and <code>cardholders</code>. <code>items</code>
is there to support searching for events. <code>card_types</code>, <code>competencies</code>,
<code>access_groups</code>, <code>roles</code>, <code>operator_groups</code>, and <code>locker_banks</code> let you
find items to attach to cardholders.</p>
</div>
<div class="paragraph">
<p>All controllers’ names are plural, and pothole_cased. You can find links
to them all with</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_why_we_need_an_operator"><a class="link" href="#_why_we_need_an_operator">Why we need an operator</a></h3>
<div class="paragraph">
<p>Everything that happens to a cardholder happens because an operator did
it. The operator could be a person working in one of the thick clients,
or it could be one of the other APIs, but whenever a cardholder changes,
Command Centre must have an operator to pin it on.</p>
</div>
<div class="paragraph">
<p>Having an operator allows Command Centre to enforce privileges. You
limit what your REST operator can do in case the client has bugs (and
starts DELETEing URLs instead of GETting them) or the API key becomes
known to the other side.</p>
</div>
<div class="paragraph">
<p>It also helps auditing. Each cardholder change causes an operator event,
with the operator and cardholders as related items. Interactive changes
use the workstation as the source, and REST changes use the REST Client.
You can run reports that filter on the source and operator to monitor
your integration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_request_process"><a class="link" href="#_the_request_process">The request process</a></h3>
<div class="paragraph">
<p>All HTTPS requests start like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The client and server establish an encrypted channel. Part of that is
a certificate exchange. The channel makes the following conversation
safe from eavesdroppers but does not confirm the identity of either
side.</p>
</li>
<li>
<p>Unless you have configured your client not to, it verifies the
identity of the server (authenticates it) by examining the contents of
the certificate that came from the server during the previous step. If
the client does not like the certificate that came from the server, it
drops the connection. Command Centre will complain to its log file when
this happens but because it did not receive a request, will not create
an event.</p>
</li>
<li>
<p>If the client trusts the server it sends its request along with a
secret that proves it is who it says it is. In our case that is an HTTP
header containing the API key.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>So far that has been a normal HTTPS conversation, the same as what
happens with every web site you visit in a browser. From here on is
specific to Command Centre.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="4">
<li>
<p>The server looks for the API key in the <code>Authorization</code> header and
finds the matching REST Client (footnote: capitalised to mean the
configuration item in Command Centre, not the REST client software on
the other end of the TCP connection) in the database. If it cannot find
one, it will raise an alarm "A REST connection was attempted with an
invalid API key".</p>
</li>
<li>
<p>If you did not disable pinned client certificates in the server
properties (Web Services tab), or if you are running 8.50 and the REST
Client item has a thumbprint on it (in the API Key tab), it checks the
thumbprint of the request’s certificate against the one on the REST
Client item. If they do not match, it responds with a 401 and raises an
alarm "A REST connection was attempted with an invalid client
certificate". The server does not check the client certificate’s chain
of trust. <a href="#_client_side_certificates">Client-side certificates</a> has all the
details of why you would want your server to check client certificates
and how to create them.</p>
</li>
<li>
<p>It checks the source host’s IP number against the REST Client item’s
IP filters. If it does not match, it responds with a 401 and raises an
alarm "A REST connection was refused because of the connecting IP
address does not match the IP filter on the REST Client <em>name of your
REST Client</em>".</p>
</li>
<li>
<p>It checks that it has a license for the controller that will handle
the request. If it does not, it sends a 403 response containing the
string "Feature not licensed".</p>
</li>
<li>
<p>It creates a new session for the operator, if there isn’t one ready,
then compares what the request is asking for against the REST Client’s
operator’s privileges from the session. If the privileges do not allow
the operation that the client requested, the server will respond with a
400-level error and a message in the body.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If all those steps succeed, the API controller processes the request,
logs an operator event if something changed, and returns a result.</p>
</div>
<div class="paragraph">
<p>In chart form, it looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="mermaid">flowchart TD

  %%
  %%
  %% Since you are reading this, the flowchart has not rendered.  Please try
  %% https://github.com/GallagherSecurity/cc-rest-docs/blob/master/training/rest_training.adoc#the-request-process
  %%
  %%

  classDef red fill:#ff9090
  o_noapikey([Raise invalid API key alarm,\nreturn 401]):::red
  o_needacert(["Raise alarm\n'client item needs a thumbprint',\nreturn 401"]):::red
  o_badprint(["Raise alarm\n'invalid client certificate',\nthumbprint in details,\nreturn 401"]):::red
  o_badip(["Raise 'bad source IP' alarm,\nreturn 401"]):::red
  o_disabled(["Return 403"]):::red
  o_clientquit(["Client faults,\nserver logs all it can\n(which is not much)"]):::red

  op1["Client connects, server sends its certificate"]
  o_reqclientcert["Server requests client certificate.\n(TLS step one)"]
  o_clientsendscert["Client sends its certificate"]
  o_clientreq["Client sends API request\nincluding API key"]

  o_argcheck(["Proceed to argument checks\nand execution"])
  style o_argcheck fill:#04ff04

  cond{"Client accepts\nserver cert?"}
  c_apikeycheck{"Is there a\nREST Client item\nwith that API key?"}
  c_versioncheck{"What version\nis the server?"}
  c_clientcertcheck1{"Is there a thumbprint\non that REST Client item?"}
  c_clientcertcheck2{"Does the server allow clients with no key?\n('Enable REST Clients with no client certificate'\nserver property on)"}

  c_clientcertcheck840{"Does the server ignore client certs?\n('Require pinned client certificates'\nserver property off)"}

  c_correctcert{"Does the client certificate match\nthe client item's thumbprint?"}
  c_sourceip{"Client item has IP restrictions,\nand the client does not meet them?"}
  c_disabled{"Client item is disabled\n(8.90 or later)?"}
  c_licence{"Server has licence\nfor requested operation?"}
  c_privcheck{"Operator has privilege\nfor requested operation?"}


  start([Start]) --&gt; op1
  style start fill:#04ff04
  op1--&gt;cond
  cond--yes--&gt;o_reqclientcert
  cond-- no --&gt;o_clientquit
  o_reqclientcert --&gt; o_clientsendscert
  o_clientsendscert --&gt; o_clientreq
  o_clientreq --&gt; c_apikeycheck

  c_apikeycheck -- yes --&gt; c_versioncheck
  c_apikeycheck -- no --&gt; o_noapikey

  c_versioncheck -- 8.50 or later --&gt; c_clientcertcheck1
  c_versioncheck -- before 8.50 --&gt; c_clientcertcheck840

  c_clientcertcheck1-- no --&gt;c_clientcertcheck2

  c_clientcertcheck840-- no --&gt;c_correctcert
  c_clientcertcheck840-- yes --&gt;c_sourceip

  c_clientcertcheck2-- yes ---&gt;c_sourceip
  c_clientcertcheck2-- no --&gt;o_needacert

  c_correctcert-- no --&gt;o_badprint
  c_clientcertcheck1-- yes --&gt;c_correctcert

  c_correctcert-- yes ---&gt;c_sourceip
  c_sourceip-- no --&gt;c_disabled
  c_sourceip-- yes --&gt;o_badip

  c_disabled-- no --&gt;c_licence
  c_disabled-- yes --&gt;o_disabled

  c_licence-- yes --&gt;c_privcheck
  c_licence-- no --&gt;o_disabled
  c_privcheck-- yes --&gt;o_argcheck
  c_privcheck-- no --&gt;o_disabled</code></pre>
</div>
</div>
<div class="paragraph">
<p>The alarms raised in the red terminal states above have a default priority of medium-high. The
server raises them for two reasons: while developing, it is useful to have a little more diagnosis
coming out of the server, and in production, it is good to know when your API is being probed.</p>
</div>
<div class="paragraph">
<p>If too many bad requests arrive too quickly, the server will assume it
is under attack and will log an alarm at maximum priority, then will
remain silent on the matter until the attack stops.</p>
</div>
<div class="paragraph">
<p>Errors also go to
<code>%PROGRAMDATA%\Gallagher\Command Centre\Command_centre.log</code>.</p>
</div>
<div class="paragraph">
<p>Unless the client rejected the server&#8217;s certificate and dropped the connection before sending
anything, the request will also go to <code>%PROGRAMDATA%\Gallagher\Command Centre\RESTAccess.log</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_first_post_and_search"><a class="link" href="#_first_post_and_search">First POST and search</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_create_a_cardholder"><a class="link" href="#_create_a_cardholder">Create a cardholder</a></h3>
<div class="paragraph">
<p>In Postman:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/postman_create_cardholder_1.png" alt="POST to create a cardholder">
</div>
<div class="title">Figure 13. POST to create a cardholder</div>
</div>
<div class="paragraph">
<p>Notice that there are two headers set: <code>Authorization</code> contains the API
key and <code>content-type</code> tells the server that the body is JSON.</p>
</div>
<div class="paragraph">
<p>This document uses this shorthand to represent that kind of HTTP query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">// POST /api/cardholders</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"firstName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"lastName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cardholder"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"division"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"href"</span><span class="p">:</span><span class="s2">"https://localhost:8904/api/divisions/2"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first line gives the verb and the file part of URL. It needs the protocol, host, and port added,
to form the final request: a POST to <code><a href="https://yourserver:8904/api/cardholders" class="bare">https://yourserver:8904/api/cardholders</a></code>. The rest is the
body.</p>
</div>
<div class="paragraph">
<p>When you create a cardholder you must specify the division and either
the first or last name, so this example is about the shortest you can
get away with.</p>
</div>
<div class="paragraph">
<p>Look at the response from the POST. It contains a <code>Location</code> header
giving the URL of our new cardholder.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/postman_create_cardholder_result.png" alt="Create cardholder result">
</div>
<div class="title">Figure 14. The result of creating a cardholder</div>
</div>
<div class="paragraph">
<p>You could GET that URL to see what you created, or…</p>
</div>
</div>
<div class="sect2">
<h3 id="_search_for_a_cardholder"><a class="link" href="#_search_for_a_cardholder">Search for a cardholder</a></h3>
<div class="literalblock">
<div class="content">
<pre>GET /api/cardholders?name=new</pre>
</div>
</div>
<div class="paragraph">
<p>That will return all the cardholders with 'new' in their name. It is
case-insensitive.</p>
</div>
<div class="paragraph">
<p>To be more precise:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/cardholders?name="cardholder, new"</pre>
</div>
</div>
<div class="paragraph">
<p>Quotes make it a full string match, rather than a substring match. It is
still case-insensitive.</p>
</div>
<div class="paragraph">
<p>Note how Command Centre matches your search string against a
concatenation of the cardholder’s last name, a comma, a space, and the
first name. It only does that if the cardholder has both names set.
Otherwise it just uses the one.</p>
</div>
<div class="paragraph">
<p>Also note that Chrome will turn the space into <code>%20</code>.</p>
</div>
<div class="paragraph">
<p>You should see your new cardholder in the results of both those queries.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cardholder_flat_fields"><a class="link" href="#_cardholder_flat_fields">Cardholder flat fields</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>"Flat fields" isn’t a term the REST API uses but it means the simple data like names, description,
and PDF values that sit at the top level of a cardholder and do not have structures of their
own. Other data such as cards, access group memberships, and competency assignments are one level
down, in arrays, and contain other fields.</p>
</div>
<div class="sect2">
<h3 id="_setup_give_a_cardholder_access_groups_and_pdfs"><a class="link" href="#_setup_give_a_cardholder_access_groups_and_pdfs">Setup: give a cardholder access groups and PDFs</a></h3>
<div class="paragraph">
<p>For a cardholder to have a PDF, both need to be on the same access
group. You cannot create PDFs or assign them to access groups via REST
so you must do that in the Configuration Client. Adding cardholders to
groups is possible via REST of course, but that is easier if you have an
existing group membership to compare your efforts against, so for now we
will do that in the client as well.</p>
</div>
<div class="sect3">
<h4 id="_create_some_pdfs"><a class="link" href="#_create_some_pdfs">Create some PDFs</a></h4>
<div class="paragraph">
<p>In the Configuration Client, Configure &#8594; Personal Data Fields (second
from the top).</p>
</div>
<div class="paragraph">
<p>Add &#8594; New Personal Data Field. Call it 'email' and set the type (on the
Type tab) to Email.</p>
</div>
<div class="paragraph">
<p>You might as well make a few more with different data types. Make at
least one text, because they have no constraints and are easiest to
experiment with.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/pdf_create_1.png" alt="Create a PDF in Configuration Client">
</div>
<div class="title">Figure 15. Create a PDF in Configuration Client</div>
</div>
</div>
<div class="sect3">
<h4 id="_create_at_least_two_access_groups_add_the_pdfs_and_add_your_cardholder"><a class="link" href="#_create_at_least_two_access_groups_add_the_pdfs_and_add_your_cardholder">Create at least two access groups, add the PDFs, and add your cardholder</a></h4>
<div class="paragraph">
<p>In the configuration client, Manage &#8594; Access Groups, right-click menu,
New &#8594; Access Group.</p>
</div>
<div class="paragraph">
<p>Open the cardholder and PDF lists out of the Manage menu so that you can
drag items out of them.</p>
</div>
<div class="paragraph">
<p>Drag your new cardholder to the Cardholder Membership tab of the access
group.</p>
</div>
<div class="paragraph">
<p>Drag your PDFs to the Personal Data tab of the access group.</p>
</div>
<div class="paragraph">
<p>Repeat!</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/pdf_to_club.png" alt="Add a PDF to a group in Config Client">
</div>
<div class="title">Figure 16. Add a PDF to a group in Config Client</div>
</div>
<div class="paragraph">
<p>Save everything in the configuration client then reload your cardholder’s details in your REST
client to see what PDF values and group memberships look like in JSON. These sections in the
cardholder API documentation cover it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>'Cardholder detail' gives the layout of a cardholder’s detail page.</p>
</li>
<li>
<p>'Cardholder PDF' describes the items in the <code>personalDataDefinitions</code> array.</p>
</li>
<li>
<p>'Cardholder access group' describes the items in the <code>accessGroups</code> array.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now you can change some of those values.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_change_a_name_authorise_change_simple_pdfs_set_user_code_etc"><a class="link" href="#_change_a_name_authorise_change_simple_pdfs_set_user_code_etc">Change a name, authorise, change simple PDFs, set user code, etc.</a></h3>
<div class="paragraph">
<p>This example changes a cardholder’s first name and two PDFs, authorises
it (de-authorised cardholders always fail access checks), turns on a
flag that allows extra unlock time on doors, and sets the user code
(which is a number you can use at keypads):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">// PATCH /api/cardholders/{id}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"firstname"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jeremiah"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"@datePDF"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2099-03-31"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"@email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a@b.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"authorised"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"useExtendedAccessTime"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"userCode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1234"</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It looks like this in Postman:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/postman_patch_cardholder_1.png" alt="PATCH a cardholder in Postman">
</div>
<div class="title">Figure 17. PATCH a cardholder in Postman</div>
</div>
<div class="paragraph">
<p>It looks a lot like that in the cardholder’s details page too, so here
is the rule:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When PATCHing flat fields on a cardholder, send back the same kind of JSON you got from a GET.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_image_pdfs_and_base64"><a class="link" href="#_image_pdfs_and_base64">Image PDFs and Base64</a></h3>
<div class="paragraph">
<p>Here is a cutting from the details page of a cardholder with an image
PDF:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">// GET /api/cardholders/{id}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="c1">...</span><span class="w">
  </span><span class="nl">"@datePDF"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2099-03-31T00:00:00Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"@Email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a@b.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"@Mugshot"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/cardholders/325/personal_data/8449"</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="c1">...</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the image PDF does not show in a cardholder’s details,
because they can be massive. Instead you get a URL. If you follow that
link you will see the image.</p>
</div>
<div class="paragraph">
<p>In order to send binary data in JSON (which cannot contain non-printable
characters), you have to encode it to Base64. This turns raw bytes into
a string of letters, numbers, plusses, and slashes (64 possible
characters), sometimes with equals signs on the end. It also increases
the size of the data by about a third. You can put the string between
quotes and send it like any other PDF:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">// PATCH /api/cardholders/{id}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"@photo"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Kilobytes+of+Base64+encoded+data==="</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
If you see a load of what looks like garbage ending with equals signs, it is probably Base64.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cards"><a class="link" href="#_cards">Cards</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Meaning credentials. In this section you will see how to give a
cardholder a card and modify existing cards.</p>
</div>
<div class="sect2">
<h3 id="_adding_updating_and_deleting_cards"><a class="link" href="#_adding_updating_and_deleting_cards">Adding, updating, and deleting cards</a></h3>
<div class="paragraph">
<p>Like all cardholder modifications, you do this with a PATCH to the
cardholder href. However a card is not a flat field: it is a member of
an array in the cardholder object called <code>cards</code>. To add an item to the
cards array, or change one, you pass in an object also called <code>cards</code>.
True to previous advice, we do all operations in one PATCH.</p>
</div>
<div class="paragraph">
<p>Borrowing from the API documentation:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The cards object can contain three arrays, named <code>add</code>, <code>update</code>, and
<code>remove</code>. Every element you put in those arrays should be in the card
schema that you see in a cardholder detail.</p>
</div>
<div class="paragraph">
<p>Each element of the <code>add</code> array will need a <code>type</code> member, at the very least. The only card field
that does not make sense here is <code>href</code>, because an href in a card block names an existing card to
change, but here you are creating one.</p>
</div>
<div class="paragraph">
<p>The example below adds two cards: one has nothing more than the type, so it will receive a computed
number and issue level, and blank <code>from</code> and <code>until</code> dates. The other is a mobile credential with a
custom initial state 'Pending sign-off'. You can tell it is a mobile credential because only they
have <code>invitation</code> blocks.</p>
</div>
<div class="paragraph">
<p>Each element of the update array should be a card to modify. It will
need the href of that card, plus the fields you want to change. Remember
you cannot change a card’s type. The example changes the issue level and
resets the until date (making it valid forever).</p>
</div>
<div class="paragraph">
<p>The only field that makes sense in an element of the remove array is <code>href</code>.</p>
</div>
<div class="paragraph">
<p>Do not put the same href in both the <code>update</code> and <code>remove</code> arrays.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Here is the example. As well as adding two credentials, modifying a third, and removing another, it
authorises the cardholder and sets a PDF called <code>employeeID</code> just to remind you that you can combine
operations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">//PATCH /api/cardholders/{id}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"authorised"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"@employeeID"</span><span class="p">:</span><span class="w"> </span><span class="s2">"THX1139"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"cards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"add"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/card_types/354"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/card_types/600"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"number"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Jock's iPhone 8"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pending sign-off"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"invitation"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jock@example.com"</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"update"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/cardholders/325/cards/97b6a24ard6d4500a9d"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"issueLevel"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
        </span><span class="nl">"until"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">],</span><span class="w">
    </span><span class="nl">"remove"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/cardholders/325/cards/77e8affe7c7e4b56"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how the hrefs of a card include the cardholder’s href and end
with a long identifier. That is because a card is a property of a
cardholder. Do not read anything more into it: treat it as opaque.</p>
</div>
</div>
<div class="sect2">
<h3 id="_dont_delete_cards_disable_them"><a class="link" href="#_dont_delete_cards_disable_them">Don’t delete cards: disable them</a></h3>
<div class="paragraph">
<p>That wasn&#8217;t a great example because generally, when you have reason to stop a card from working, you
want:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a permanent reminder of why you did it,</p>
</li>
<li>
<p>to prevent another operator assigning the same card number to them later (so that if someone finds
a card on the ground and tries it, it won’t open the building), and</p>
</li>
<li>
<p>to know who a lost card was assigned to in case it turns up again.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Command Centre achieves the first two of these goals if you delete an old card but it is easier if
you leave it card in the system, non-functional. You can set its end date into the past or set its
state to one of the disabled states.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Deleting cards loses information about it, and can reduce the security of your building.<br>
Disable them instead.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_group_memberships"><a class="link" href="#_group_memberships">Group memberships</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section you will add your cardholder to an access group and
modify the membership.</p>
</div>
<div class="sect2">
<h3 id="_add_an_access_group_membership"><a class="link" href="#_add_an_access_group_membership">Add an access group membership</a></h3>
<div class="paragraph">
<p>You will need the href of your cardholder that you used in the
<a href="#_cardholder_detail">cardholder detail GET</a> or the
<a href="#_adding_updating_and_deleting_cards">cardholder PATCH</a>, or that came
back from your POST when you <a href="#_create_a_cardholder">created a
cardholder</a>.</p>
</div>
<div class="paragraph">
<p>You also need the href of your access group. You can see all your access
groups by querying the access groups controller. Hint: <code>GET /api</code> then look
in the block called <code>accessGroups</code>. Extra hint: <code>GET /api/access_groups</code>.</p>
</div>
<div class="paragraph">
<p>When you have those two hrefs, substitute them into:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">// PATCH /api/cardholders/325 </span><span class="w"><b class="conum">(1)</b>
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"accessGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"add"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"accessGroup"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_groups/5388"</span><span class="p">}</span><span class="w"> // <b class="conum">(2)</b>
        </span><span class="p">,</span><span class="w"> </span><span class="nl">"from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-01-31T02:11:00Z"</span><span class="w">
        </span><span class="p">,</span><span class="w"> </span><span class="nl">"until"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2037-01-31T02:11:00Z"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>is the href of your cardholder.</p>
</li>
<li>
<p>is the href of your access group.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>(Remember that the first line does not go into the body of your HTTP query, and your actual URL will
start with <code>https://</code> with a host and port. Also note the alternative comma style: putting them on
the start of the line makes commenting them out easier.)</p>
</div>
<div class="paragraph">
<p>If you use the wrong access group identifier, or your operator does not
have 'Modify Access Control' on the access group, you will be told:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="p">{</span><span class="w">
  </span><span class="nl">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Invalid access group href: https://localhost:8904/api/access_groups/53888"</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When you get it right, the server will return 204 and next time you GET
your cardholder the result will contain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">// GET /api/cardholders/325</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="c1">...</span><span class="w">
  </span><span class="nl">"accessGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/cardholders/325/access_groups/1069"</span><span class="p">,</span><span class="w"> // <b class="conum">(1)</b>
      </span><span class="nl">"accessGroup"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Boney M"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_groups/5388"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Active"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"active"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2017-01-31T02:11:00Z"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"until"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2037-01-31T02:11:00Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The 'Cardholder access group' section of the cardholder API
documentation helps with interpreting that.</p>
</div>
<div class="paragraph">
<p>The marked URL is the href of the cardholder&#8217;s group memberrship, which is a link between the
cardholder (ID 325, in my case) and the access group (ID 5338).  It starts with the href of the
cardholder, because it is a property of that cardholder and serviced by the cardholders controller,
but do not try to interpret it more. Certainly do not read anything into the number on the end
(1069), and do not be surprised if you have an item with the same ID.</p>
</div>
<div class="paragraph">
<p><a href="#_the_importance_of_api">The importance of /api</a> and <a href="#_identifiers_in_your_app">Identifiers in your app</a> go into what you should not do with
hrefs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_edit_an_existing_group_membership"><a class="link" href="#_edit_an_existing_group_membership">Edit an existing group membership</a></h3>
<div class="paragraph">
<p>Correct the URL of the cardholder and the access group membership in this PATCH:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">//PATCH /api/cardholders/325</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"accessGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"update"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/cardholders/325/access_groups/1069"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2027-03-09"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If it returns a 204, GET your cardholder again and look at its access
group memberships. The from date should have changed from 2017 to 2027,
and the membership href will be different.</p>
</div>
<div class="paragraph">
<p>The server changes the href after an update to prevent race conditions
when there are two operators active. It means the two of you cannot
change the group membership at the same time - the second one in will
fail. The advice, therefore, is to update your cardholder as soon as
possible after retrieving its details (footnote: probably good advice
for a fetch and update on any API).</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<strong>Do not cache the hrefs of links between items</strong>. They change with operator actions.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_cardholder_cont"><a class="link" href="#_create_a_cardholder_cont">Create a cardholder, cont.</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you have access groups, cards, and PDFs, you can create a fully
configured cardholder in one request. Here is an example that creates a
cardholder, sets a PDF called 'email', puts it in an access group (which
is necessary for the PDF to work), and gives them a card.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">// POST /api/cardholders</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"firstName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"New"</span><span class="p">,</span><span class="w"> </span><span class="nl">"lastName"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Cardholder"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test cardholder"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"division"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"href"</span><span class="p">:</span><span class="s2">"https://localhost:8904/api/divisions/2"</span><span class="p">}</span><span class="w">
  </span><span class="nl">"useExtendedAccessTime"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
  </span><span class="nl">"usercode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1234"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"@email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a@b.com"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"accessGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"accessGroup"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_groups/334"</span><span class="p">},</span><span class="w"> // <b class="conum">(1)</b>
      </span><span class="nl">"from"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2019-01-01"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"cards"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/card_types/342"</span><span class="p">},</span><span class="w"> // <b class="conum">(1)</b>
      </span><span class="nl">"number"</span><span class="p">:</span><span class="s2">"3162"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nl">"zzzcompetencies"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> // <b class="conum">(2)</b>
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"competency"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/competencies/5394"</span><span class="p">},</span><span class="w">
      </span><span class="nl">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>These identify an access group and card type for your new cardholder.</p>
</li>
<li>
<p>Never mind the competency yet. The <code>zzz</code> makes the server ignore it.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You will need to change the marked numbers to the IDs of an access group and a card type on
your system. You can get those with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/access_groups</pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/card_types</pre>
</div>
</div>
<div class="paragraph">
<p>In Chrome, those calls will look like
<code>https://<em>yourhost</em>:8904/api/access_groups</code> and
<code>https://<em>yourhost</em>:8904/api/card_types</code>.</p>
</div>
<div class="paragraph">
<p>An actual application would also find the href of the correct division,
but for today is it safe to assume that the href of the root division is
<code>&#8230;&#8203;/divisions/2</code>.</p>
</div>
<div class="paragraph">
<p>After changing the <code>334</code> and the <code>342</code> put the JSON into Postman and POST it to
<code>/api/cardholders</code>. It should return you the href of a new cardholder, as it did in
<a href="#_create_a_cardholder">Create a cardholder</a>.</p>
</div>
<div class="paragraph">
<p>The <code>zzz</code> is in there to stop the REST API trying to add a competency to
your new cardholder, which would fail because you have not created a
competency yet. There is nothing special about three 'Z’s&#8201;&#8212;&#8201;the server
just ignores anything it does not recognise.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<strong>The server will ignore fields it does not recognise</strong>. Beware of this, as you may think
your calls are succeeding when in fact they ard doing less than you want them to.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That is more of an advantage that a disadvantage. It means we can write
clients that degrade gracefully on Command Centre servers that are not
the most recent version or are missing licences. Also, introducing typos
to the names of your JSON objects is a convenient way of commenting them
out. You can also prepend lines with <code>//</code>. It is not valid JSON but you
can get away with it for now.</p>
</div>
<div class="paragraph">
<p>Back to our example. If you want to create a cardholder with a
competency:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>make a competency in the Configuration Client,</p>
</li>
<li>
<p>find its href from the competencies controller (<code>GET /api/competencies</code>),</p>
</li>
<li>
<p>change your JSON (remove the <code>zzz</code> and change the 5394), and</p>
</li>
<li>
<p>try the POST again.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It should fail, complaining that you cannot have two cards with the same card number. Change the
<code>3162</code> and try again (or change <code>number</code> to <code>znumber</code> and let Command Centre pick a card number for
you&#8201;&#8212;&#8201;probably 3163).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_coding_considerations"><a class="link" href="#_coding_considerations">Coding considerations</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you don&#8217;t mind a return to theory, here are several things you should keep in mind when building
an integration against this API.</p>
</div>
<div class="sect2">
<h3 id="_recap"><a class="link" href="#_recap">Recap</a></h3>
<div class="ulist">
<ul>
<li>
<p><code>/api</code> returns links to summary pages. Why that is important is in
<a href="#_the_importance_of_api">The importance of /api</a>.</p>
</li>
<li>
<p>At time of writing, the URLs of most summary pages end with the name of the
<a href="#_api_controllers">controller</a>, such as <code>cardholders</code> or <code>access_groups</code>. Others end with their
specific purpose, such as <code>card_types/assign</code>, which returns the card types your operator can assign
to people.</p>
</li>
<li>
<p>Summary pages show you many items without much detail of each. You can add sorting and pagination
parameters.  <a href="#_cardholder_summary">Cardholders</a>, <a href="#_first_gets_part_two_events">alarms and
events</a>, and <a href="#_other_command_centre_items">other items</a>. Tell the API to sort its results by ID
because it is quicker, and more reliable when operators are changing the database. Unless you’re
writing a user app and really must have your results sorted by name.</p>
</li>
<li>
<p>You can also add filters to summary pages, turning them into search pages. See
<a href="#_search_for_a_cardholder">Search for a cardholder</a> and <a href="#_event_filters">Event filters</a>.</p>
</li>
<li>
<p>In v8.00+ you can add fields from the details page to the summary page
of items, and in 8.40+, events. Or you can specify the exact fields you
need, if you want to save traffic.</p>
</li>
<li>
<p>You walk the result set using links named <code>next</code> and <code>previous</code>.</p>
</li>
<li>
<p>Detail pages give you more on an item, but only one item at a time.  Their URLs end with short
alphanumeric identifiers.  <a href="#_cardholder_detail">A cardholder</a>, for example.  There is not much
use for detail pages in the API after v8.00, since you can add all their fields to the summary pages.</p>
</li>
<li>
<p>To create a cardholder, <a href="#_first_post_and_search">POST the
cardholders controller</a>. The body of the POST is pretty much the same as
you get from a GET of an existing cardholder, but with fewer fields.</p>
</li>
<li>
<p>To update a cardholder, <a href="#_cardholder_flat_fields">PATCH its href</a>.
That includes <a href="#_cards">adding cards</a>.</p>
</li>
<li>
<p>If you are changing PDFs or flat fields, the body of the PATCH looks a
lot like what you got from a GET to the same URL. Put <code>@</code>-symbols on the
front of your PDF names.</p>
</li>
<li>
<p>If you are updating cards, lockers, access groups, relationships,
competencies, or operator groups, you will be sending arrays called
<code>add</code>, <code>remove</code>, and <code>update</code> inside objects called <code>cards</code>, <code>lockers</code>,
etc.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_only_one_cardholder_at_a_time"><a class="link" href="#_only_one_cardholder_at_a_time">Only one cardholder at a time</a></h3>
<div class="paragraph">
<p>In all these flat field, card, and group membership examples you were
working on one cardholder at a time. That is the only way you can
operate, because the cardholder you are changing is named by the URL. If
you want to change many cardholders, you must do it in a loop.</p>
</div>
<div class="paragraph">
<p>On the upside, you can change everything about the cardholder in one
PATCH. In fact, it is most efficient to do so. While you can use DELETE
to remove one card or group membership or relationship at a time, you
will see much better throughput if you combine it with the other changes
for that cardholder and send them as one PATCH. The same applies to
creating a cardholder: it is much quicker to do it as one POST than as a
POST followed by one or more PATCHes. The other advantage is that any
one is atomic: all the changes you put in the body happen, or none of
them do. So:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When creating a new cardholder, do it all in one POST.<br>
When modifying an existing cardholder, do it all in one PATCH.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_importance_of_api"><a class="link" href="#_the_importance_of_api">The importance of /api</a></h3>
<div class="paragraph">
<p>Forget all the URLs you have seen so far, except the first, and do not
write them into your applications. The only address that your
application should have coded into it is <code>/api</code>. You can learn every
other address you need with a GET of that. It will return a table of
contents like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">// GET /api</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7.90.0.0"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"features"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"accessGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"accessGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_groups"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"accessZones"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"accessZones"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_zones"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"alarms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"alarms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/alarms"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"updates"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/alarms/updates"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"divisions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/divisions/view_alarms"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"alarmZones"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"alarmZones"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/alarm_zones"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"cardholders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"cardholders"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/cardholders"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"updateLocationAccessZones"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_zones/update_cardholder_location"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"changes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/cardholders/changes"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"cardTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"cardTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/card_types"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"assign"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/card_types/assign"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"competencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"competencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/competencies"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"doors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"doors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/doors"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"events"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/events"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"updates"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/events/updates"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"eventGroups"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/events/groups"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"divisions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/divisions/view_events"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"fenceZones"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"fenceZones"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/fence_zones"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"inputs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"inputs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/inputs"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"items"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/items"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"itemTypes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/items/types"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"updates"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/items/updates"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"lockerBanks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"lockerBanks"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/locker_banks"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"macros"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"macros"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/macros"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"outputs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/outputs"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"personalDataFields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"personalDataFields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/personal_data_fields"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"roles"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"roles"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/roles"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You should parse the <code>features</code> block of that page for the URLs of the
calls you need. It contains one block for each controller in the API:
cardholders, events, alarms, etc. Some of those blocks contain one more
block, in turn containing an href for the base call for that controller.
Other controllers (<code>card_types</code>) contain more than one, each containing an
href for a different call. For example, the events and alarms
controllers also provide a <code>divisions</code> call which lists the divisions in
which your operator has the privilege to see events and alarms,
respectively.</p>
</div>
<div class="sect3">
<h4 id="_do_not_code_urls_into_applications"><a class="link" href="#_do_not_code_urls_into_applications">Do not code URLs into applications</a></h4>
<div class="paragraph">
<p>Because Gallagher reserves the right to change them. If you start at
<code>/api</code>, your application will stay compatible through Command Centre
upgrades.</p>
</div>
<div class="paragraph">
<p>While it is tempting to hard-code a string <code>/api/cardholders</code> into
your application, it is not that much more development effort to get
that URL from the contents page and make your code forward-compatible.
Help yourself to the sample C#, starting with ClientManagerAsync.cs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_identifiers_in_your_app"><a class="link" href="#_identifiers_in_your_app">Identifiers in your app</a></h3>
<div class="paragraph">
<p>There are two API identifiers: IDs and hrefs.</p>
</div>
<div class="paragraph">
<p>The short alphanumeric string that comes in a field called <code>id</code> is there purely for use in query
parameters, such as filters. Because you add them to URLs they have to be short and free of
punctuation, so we do not use the longer identifier that comes next. <a href="#_event_filters">Event filters</a> shows how to
use them to find events.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<strong>Do not treat IDs as integers</strong>. They are alphanumeric. A future version may add letters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The URL that comes in a field called <code>href</code> is how you reference
objects, both as addresses in your own GETs, DELETEs, and PATCHes, but
also in the bodies of those requests and POSTs when you need to connect
two objects. When adding a card to a cardholder, for example, you need
to send the href for the new card’s card type. You would find that href
using the card_types controller. As another example, when connecting two
cardholders with a relationship, you need to PATCH the href of one of
the cardholders with the href of the role (from the roles controller)
and of the other cardholder (from a search of cardholders).</p>
</div>
<div class="sect3">
<h4 id="_some_hrefs_are_meant_to_404"><a class="link" href="#_some_hrefs_are_meant_to_404">Some hrefs are meant to 404</a></h4>
<div class="paragraph">
<p>Many hrefs will respond to a GET, but some exist purely for
identification: cards, relationships, and group memberships, for
example. Those hrefs are for use inside the body of a PATCH to modify a
cardholder. You can DELETE some of them but GETting one of these will
always return 404.</p>
</div>
</div>
<div class="sect3">
<h4 id="_many_hrefs_are_dynamic"><a class="link" href="#_many_hrefs_are_dynamic">Many hrefs are dynamic</a></h4>
<div class="paragraph">
<p>Some hrefs change regularly: access group membership IDs, for example,
change every time you modify the underlying membership, even if you only
change its end-date. For that reason you must start all changes to a
cardholder with a GET of that cardholder. That will give you up-to-date
hrefs for linked group memberships, roles, cards, etc., which you can
then use in the body of a PATCH.</p>
</div>
</div>
<div class="sect3">
<h4 id="_you_can_use_them_to_cross_reference_cardholders_in_an_integration"><a class="link" href="#_you_can_use_them_to_cross_reference_cardholders_in_an_integration">You can use them to cross-reference cardholders in an integration</a></h4>
<div class="paragraph">
<p>External systems will have their own user identifiers: staff or student
ID numbers, usernames, or national IDs. You might like to store that ID
in a PDF and use the PDF search (<code>/api/cardholders?pdf_yyy=<em>zzz</em></code>,
described in the developer documentation) to find the href of your
cardholder when it comes time to synchronise. Then you do not have to
store a copy of the href.</p>
</div>
<div class="paragraph">
<p>That could be slow for large numbers of cardholders. Instead, you could
retain the href returned to you when you created your cardholder and use
that forever after. There would be no need for a PDF holding the
external identifier inside Command Centre.</p>
</div>
<div class="paragraph">
<p>However that is no use for cardholders that your integration did not
create. Plus you risk losing your cardholder if its href ever changes
(which could occur if another operator or integration deletes and
recreates it, or Gallagher changes the layout of hrefs).</p>
</div>
<div class="paragraph">
<p>The recommended option is a blend of the two: give every cardholder a
PDF containing their external ID and cache their href externally. If
your cache does not have it, or if using it returns a 400-level error,
refresh your cache using a PDF search.</p>
</div>
</div>
<div class="sect3">
<h4 id="_subtract_the_host_and_port_then_replace_them_with_values_from_your_integrations_configuration"><a class="link" href="#_subtract_the_host_and_port_then_replace_them_with_values_from_your_integrations_configuration">Subtract the host and port then replace them with values from your integration’s configuration</a></h4>
<div class="paragraph">
<p>You will note that every cardholder href begins with the scheme, host,
and port: <code><a href="https://localhost:8904" class="bare">https://localhost:8904</a></code> in these examples. I am going to
contradict earlier advice ever so slightly and suggest that you drop the
<code>https://<em>host</em>:port</code> from the front of an href before storing it, then
add the host and port from your integration’s configuration before using
it again. By doing that you give yourself the flexibility to change the
hostname or port without invalidating your cache of hrefs.</p>
</div>
<div class="paragraph">
<p>For example, for a cardholder with href
<code><a href="https://localhost:8904/api/cardholders/123" class="bare">https://localhost:8904/api/cardholders/123</a></code>, store
<code>api/cardholders/123</code> in your database. The application must have
<code>locahost</code> and <code>8904</code> in its configuration somewhere (how else could it
make HTTP requests?), so when it comes to find that cardholder again,
prepend <code><a href="https://localhost:8904/" class="bare">https://localhost:8904/</a></code> to the stored value. When your IT
people change the server’s hostname or shift the service to another
port, all you have to do is change your configuration. Which you had to
anyway.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_do_not_build_your_own_hrefs_from_ids"><a class="link" href="#_do_not_build_your_own_hrefs_from_ids">Do not build your own hrefs from IDs</a></h3>
<div class="paragraph">
<p>Buoyed with confidence gained following links around our API, you will
be tempted to store just the parts of hrefs that seem to matter and
reconstruct them later. In the interests of forward compatibility:</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<strong>Do not interpret href paths, and do not build your own.</strong> We change them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a reminder, the parts of a URL relevant to us are the protocol
('scheme'), host, port, path, and query:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>scheme://host:port/path?query</pre>
</div>
</div>
<div class="paragraph">
<p>The scheme will always be <code>HTTPS</code>:  you can take that as read. By all means,
replace the hostname and port number and add your own search parameters
to the query on the end of URLs you take from GET /api, but please do
not tinker with the path. Treat that as opaque.</p>
</div>
<div class="paragraph">
<p>For example, in version 8.10 the path to a locker was</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/api/locker_banks/locker_bank_id/lockers/locker_id</pre>
</div>
</div>
<div class="paragraph">
<p>In 8.20 it changed to</p>
</div>
<div class="literalblock">
<div class="content">
<pre>/api/lockers/locker_id</pre>
</div>
</div>
<div class="paragraph">
<p>Client code that inserts a locker bank ID and locker ID into the
hard-coded string <code>/api/locker_banks/{1}/lockers/{2}</code> will work against
an 8.10 server but fail when the server upgrades to 8.20. Client code
that takes the href from a locker bank page will work with both
versions.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sort_by_id_and_get_all_summary_pages_without_delay"><a class="link" href="#_sort_by_id_and_get_all_summary_pages_without_delay">Sort by ID, and get all summary pages without delay</a></h3>
<div class="paragraph">
<p>By default, item summaries arrive sorted by name. That can cause a race
condition:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You get the first 1000 cardholders, sorted by name.</p>
</li>
<li>
<p>Another operator (or your own update) changes the name of one of those
cardholders to part of the alphabet you have not collected yet, or vice
versa.</p>
</li>
<li>
<p>The next 1000 cardholders will either contain one you already
received, or will skip one you did not.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There are three things you can do to reduce this risk:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sort by ID. Command Centre does not recycle IDs so no cardholder can
slip into part of the database you have already extracted.</p>
</li>
<li>
<p>Collect hrefs from the summary pages, following the next link until it
no longer arrives, before using any of them. This means you collect
everyone in the minimum possible time, and if you do update your
cardholders you will not mess in your own yard.</p>
</li>
<li>
<p>Get thousands at a time so that you make fewer calls.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_monitoring_for_cardholder_changes_is_much_better_in_8_30"><a class="link" href="#_monitoring_for_cardholder_changes_is_much_better_in_8_30">Monitoring for cardholder changes is much better in 8.30</a></h3>
<div class="paragraph">
<p>Version 7.90 supports change tracking through the events API. If you
filter for operator events you will be informed of every change using
long polls (below): the href of the affected cardholder or access group
will be in the event. In 8.00+ the href of the operator who made the
change will also be in the event.</p>
</div>
<div class="paragraph">
<p>Version 8.30 adds a call to the cardholders controller that makes
synchronising them much simpler. It can tell you which fields changed on
a cardholder and what their values were before and after the change, and
what their current values are. All the details are in a section called
"Cardholder changes" in the developer documentation but here is a
quick run-down:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Send a GET to request a bookmark to the current head of the list of
cardholder changes.</p>
</li>
<li>
<p>Synchronise your system with Command Centre using other cardholder
methods. It does not matter how long this takes.</p>
</li>
<li>
<p>GET the bookmark you received previously. That will send you all the
changes that happened since then, plus a new bookmark.</p>
</li>
<li>
<p>Process those changes, if there were any. Sleep if there were not.</p>
</li>
<li>
<p>Go back to step 3.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To reduce the work you have to do and chatter on the wire using <code>filter</code>
and <code>fields</code> query parameters. <code>filter</code> limits the changes you receive
to those that you’re particularly interested in (you might not care
about anything except changes to PDFs, for example), and <code>fields</code> lets
you request more or less data about each change and its cardholder.</p>
</div>
</div>
<div class="sect2">
<h3 id="_long_polls"><a class="link" href="#_long_polls">Long polls</a></h3>
<div class="paragraph">
<p>A <em>long poll</em> is a way for HTTP servers to send updates to interested
clients. The client registers its interest by sending an HTTP GET, and
the server pushes to the client by responding when something of interest
occurs.</p>
</div>
<div class="paragraph">
<p>Using telephone calls as an analogy, a traditional poll would have the
client calling the server, the server answering, then hanging up
immediately if there was nothing to report. The client would then need
to wait a time and try again.</p>
</div>
<div class="paragraph">
<p>If the telephone server supported long polls, however, it would leave
the incoming call ringing until it had something to say. The client
would carry on about its business until the server picked up. After
hearing the server’s response the client would call back when it wished.
Immediately if it was in a particular hurry.</p>
</div>
</div>
<div class="sect2">
<h3 id="_benchmarks"><a class="link" href="#_benchmarks">Benchmarks</a></h3>
<div class="paragraph">
<p>These are the results of informal performance tests of Command Centre
7.90 running on reasonably capable hardware.</p>
</div>
<div class="paragraph">
<p>You will not achieve these numbers without following the advice in the
'efficiency tips' sections of the developer documentation.</p>
</div>
<div class="sect3">
<h4 id="_extracting_events"><a class="link" href="#_extracting_events">Extracting events</a></h4>
<div class="paragraph">
<p>Sustained an average of two to four thousand per second from a database
of four million.</p>
</div>
</div>
<div class="sect3">
<h4 id="_extracting_12000_cardholders"><a class="link" href="#_extracting_12000_cardholders">Extracting 12,000 cardholders</a></h4>
<div class="paragraph">
<p>Extracting their cards, access groups, and PDFs took three to four
minutes on a v7.90 server. The process was to request a summary page of
10,000 cardholders, then the remaining 2,000, then iterate through all
their hrefs, getting their details pages one by one.</p>
</div>
<div class="paragraph">
<p>That is a poor approach these days.  Extracting the same fields for the
same <strong>12,000 cardholders took 12 seconds</strong> on the same server running
v8.00. This process used the <code>fields</code> parameter to add cards, access
groups, and PDFs to the summary page so that the test did not have to
get any detail pages.</p>
</div>
</div>
<div class="sect3">
<h4 id="_extracting_200000_cardholders"><a class="link" href="#_extracting_200000_cardholders">Extracting 200,000 cardholders</a></h4>
<div class="paragraph">
<p>Now on 8.30 and different hardware, extracting the names of 200,000
cardholders took one minute with <code>top=1000&amp;sort=id</code>, or 28 minutes
without. That is how important those query parameters are. Use them!</p>
</div>
<div class="paragraph">
<p>Part of the three-times speedup from the previous test will be due to the absence
of PDFs: they can be expensive to extract.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_cardholders"><a class="link" href="#_creating_cardholders">Creating cardholders</a></h4>
<div class="paragraph">
<p>Ten thousand took an hour. The test added a cardholder with a card and a
handful of group memberships and PDFs.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_events"><a class="link" href="#_advanced_events">Advanced events</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_event_filters"><a class="link" href="#_event_filters">Event filters</a></h3>
<div class="paragraph">
<p>The developer documentation is authoritative on how to restrict your
event results, but here is an introduction.</p>
</div>
<div class="paragraph">
<p>You can filter by the occurrence date/time, the source item, the event’s division (which is almost
always the source&#8217;s division), the event’s type, the type’s group (all event types are grouped, and
picking a group is synonymous with picking a few types), or the event’s cardholder.</p>
</div>
<div class="paragraph">
<p>In 8.70 and later you can limit the events to those related to a particular item.  For example, by
specifying a cardholder&#8217;s ID you will receive the same events that would appear in Command Centre&#8217;s
activity report for that cardholder.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">To filter by …</th>
<th class="tableblock halign-left valign-top">Add a query parameter called…</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>type</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event type group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>group</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cardholder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cardholder</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>source</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>division</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>after</code> and / or <code>before</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Related item</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relatedItem</code>, and be running 8.70 or later.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, to find all card events ('access granted', 'access denied',
etc.):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET https://localhost:8904/api/events?group=23</pre>
</div>
</div>
<div class="paragraph">
<p>The API documentation shows you where the 23 comes from.</p>
</div>
<div class="paragraph">
<p>To watch two cardholders:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET https://localhost:8904/api/events?id=325,8445</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ids_to_use_in_filters"><a class="link" href="#_ids_to_use_in_filters">IDs to use in filters</a></h3>
<div class="paragraph">
<p>To keep the query strings manageable, these filters take short,
alphanumeric strings as IDs rather than the URLs that the API generally
uses for identifying items. At the version of writing (8.70) these IDs are low numbers,
but we reserve the right to introduce letters in the future, so do not
interpret them as integers.</p>
</div>
<div class="paragraph">
<p>These are your options for finding the IDs you need to build a filter
string:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>look at one of the events you want in the API. Everything you can filter by is there;</p>
</li>
<li>
<p>look at <code>/api/events/groups</code> for event types and their
groups;</p>
</li>
<li>
<p>look at <code>/api/cardholders</code> for cardholders;</p>
</li>
<li>
<p>look at <code>/api/items</code> for all other items, using a type filter of its own from looking at
<code>/api/items/types</code>;</p>
</li>
<li>
<p>if running v8.00 or later, look at the controllers for doors, outputs, alarm zones, access zones,
and fence zones, linked from <code>/api</code>;</p>
</li>
<li>
<p>If running v8.10 or later, look at the inputs controller.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, to find all your doors you would</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET https://localhost:8904/api/doors</pre>
</div>
</div>
<div class="paragraph">
<p>(after getting that URL from <code>GET /api</code>, of course)</p>
</div>
<div class="paragraph">
<p>The doors controller arrived in 8.00, so if you have 7.90 or older you would</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET https://localhost:8904/api/items?type=11</pre>
</div>
</div>
<div class="paragraph">
<p>That 11 came from</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET https://localhost:8904/api/items/types</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filtering_by_date"><a class="link" href="#_filtering_by_date">Filtering by date</a></h3>
<div class="paragraph">
<p>Even though the <code>before</code> and <code>after</code> fields are only accurate to a second,
filtering by date is 'smart' for reports: the result set will not
include events that occurred during the <code>before</code> second. For example,
<code>before=2019-01-01T00:00:00Z</code> will not return you any events from 2019 or later years.
Pass the <code>before</code> parameter for one report as the <code>after</code> parameter of
the next. You never need to use <code>23:59:59</code>, and there is no risk of
missing an event that happens in the last second, or in a leap second.</p>
</div>
<div class="paragraph">
<p>All date-times should be in ISO-8601. If you omit fields (such as
minutes or seconds) Command Centre will assume sensible defaults, but
the best advice is to be explicit (especially about the time zone).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<strong>Put a timezone specifier in all date-times!</strong> Otherwise the outcome will depend on settings
on the server.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_adding_pdf_values_to_the_cardholders_in_events"><a class="link" href="#_adding_pdf_values_to_the_cardholders_in_events">Adding PDF values to the cardholders in events</a></h3>
<div class="paragraph">
<p>Card events such as 'access granted' use the door as the source but also
have a related cardholder. The event JSON includes the cardholder’s name
and href, but if you want to use your own identifiers for cardholders
you can also ask for a PDF to come out with the event. Do that by adding
<code>fields=defaults,cardholder.pdf_XXXX</code> where <code><em>XXXX</em></code> is the ID of the PDF.
Find that ID with a query to <code>/api/personal_data_fields</code>, adding
<code>?name="your_pdf_name"</code> if you want Command Centre to do the searching
for you.</p>
</div>
<div class="paragraph">
<p>In order to see that PDF, your REST operator will need the appropriate
privileges. Otherwise the event will come out without the PDF. 'View
Cardholder' on the cardholder might not be enough: while PDFs are
visible by default, an operator can hide them, in which case your REST
client’s operator group will need to override that to readable or
read/write.</p>
</div>
</div>
<div class="sect2">
<h3 id="_writing_an_interactive_event_viewer"><a class="link" href="#_writing_an_interactive_event_viewer">Writing an interactive event viewer</a></h3>
<div class="paragraph">
<p>If I was writing an interactive application to monitor events as they
occurred, while also allowing browsing the event history, I would get
the most recent&#8212;&#8203;enough to fill a screen&#8212;&#8203;with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api/events?previous=true&amp;top=20</pre>
</div>
</div>
<div class="paragraph">
<p>Then I would set an asynchronous task waiting on the <code>updates</code> link,
which would return with new events as they happened.</p>
</div>
<div class="paragraph">
<p>At the same time I would follow the <code>next</code> and <code>previous</code> links to
collect more events as my user scrolled back and forth.</p>
</div>
</div>
<div class="sect2">
<h3 id="_worked_example_reading_alarms"><a class="link" href="#_worked_example_reading_alarms">Worked example: reading alarms</a></h3>
<div class="paragraph">
<p>What follows is a series of calls that collect alarms from the 7.80
version of the alarms API. There may be extra fields in later versions
of Command Centre.</p>
</div>
<div class="sect3">
<h4 id="_collecting_all_unprocessed_alarms_with_one_active_forced_door"><a class="link" href="#_collecting_all_unprocessed_alarms_with_one_active_forced_door">Collecting all unprocessed alarms with one active forced door</a></h4>
<div class="paragraph">
<p>The initial HTTP GET of <code><a href="http://localhost/api/alarms" class="bare">http://localhost/api/alarms</a></code> returns all
unprocessed alarms: a bad login, a network problem, and two forced
doors, in this example. The second forced door is still open, so the
alarm is active and instead of links for processing it we have links for
force processing it, because you are not really meant to process active
alarms.</p>
</div>
<div class="paragraph">
<p>Note they are in the order that they arrived at the server, not the
order they happened.  Interesting pieces are in bold face.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc">{
  "alarms": [
    {
      "href": "http://localhost:8904/api/alarms/289",
      "id": "289",
      "time": "2016-11-10T14:17:00",
      "message": "<strong>Operator logon failed</strong> for FT Workstation on GNZ-PC1302",
      "source": { "name": "FT Workstation on GNZ-PC1302" },
      "type": "Operator Logon Failed",
      "priority": 3,
      "state": "unacknowledged",
      "active": false,
      "division": { "href": "http://localhost:8904/api/divisions/2" },
      "view": { "href": "http://localhost:8904/api/alarms/289/view" },
      "comment": { "href": "http://localhost:8904/api/alarms/289/comment" },
      "acknowledgeWithComment": { "href": "http://localhost:8904/api/alarms/289/acknowledge" },
      "acknowledge": { "href": "http://localhost:8904/api/alarms/289/acknowledge" },
      "processWithComment": { "href": "http://localhost:8904/api/alarms/289/process" },
      "process": { "href": "http://localhost:8904/api/alarms/289/process" }
    },
    {
      "href": "http://localhost:8904/api/alarms/296",
      "id": "296",
      "time": "2016-11-10T13:58:16",
      "message": "<strong>Fat controller - Command Centre comms interrupted</strong>",
      "source": { "name": "Fat controller" },
      "type": "Comms failed to Command Centre",
      "priority": 6,
      "state": "unacknowledged",
      "active": false,
      "division": { "href": "http://localhost:8904/api/divisions/2" },
      "view": { "href": "http://localhost:8904/api/alarms/296/view" },
      "comment": { "href": "http://localhost:8904/api/alarms/296/comment" },
      "acknowledgeWithComment": { "href": "http://localhost:8904/api/alarms/296/acknowledge" },
      "acknowledge": { "href": "http://localhost:8904/api/alarms/296/acknowledge" },
      "processWithComment": { "href": "http://localhost:8904/api/alarms/296/process" },
      "process": { "href": "http://localhost:8904/api/alarms/296/process" }
    },
    {
      "href": "http://localhost:8904/api/alarms/301",
      "id": "301",
      "time": "2016-11-10T14:18:27",
      "message": "<strong>Warehouse door has been forced.</strong>",
      "source": { "name": "Warehouse door" },
      "type": "Forced Door",
      "priority": 8,
      "state": "unacknowledged",
      "active": false,
      "division": { "href": "http://localhost:8904/api/divisions/2" },
      "view": { "href": "http://localhost:8904/api/alarms/301/view" },
      "comment": { "href": "http://localhost:8904/api/alarms/301/comment" },
      "acknowledgeWithComment": { "href": "http://localhost:8904/api/alarms/301/acknowledge" },
      "acknowledge": { "href": "http://localhost:8904/api/alarms/301/acknowledge" },
      "processWithComment": { "href": "http://localhost:8904/api/alarms/301/process" },
      "process": { "href": "http://localhost:8904/api/alarms/301/process" }
    },
    {
      "href": "http://localhost:8904/api/alarms/306",
      <strong>"id": "306"</strong>,
      "time": "2016-11-10T14:21:41",
      <strong>"message": "Front door has been forced."</strong>,
      "source": { "name": "Front door" },
      "type": "Forced Door",
      "priority": 8,
      "state": "unacknowledged",
      <strong>"active": true</strong>,
      "division": { "href": "http://localhost:8904/api/divisions/2" },
      "view": { "href": "http://localhost:8904/api/alarms/306/view" },
      "comment": { "href": "http://localhost:8904/api/alarms/306/comment" },
      "acknowledgeWithComment": { "href": "http://localhost:8904/api/alarms/306/acknowledge" },
      "acknowledge": { "href": "http://localhost:8904/api/alarms/306/acknowledge" },
      <strong>"forceProcess": { "href": "http://localhost:8904/api/alarms/306/process" }</strong>
    }
  ],
  "updates": { "href": "http://localhost:8904/api/alarms/updates?id=306" }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_collecting_updated_alarms_after_closing_the_door"><a class="link" href="#_collecting_updated_alarms_after_closing_the_door">Collecting updated alarms after closing the door</a></h4>
<div class="paragraph">
<p>Next we close the front door, the kicking in of which caused alarm 306,
and GET the updates URL at the end of the previous result,
<code><a href="http://localhost/api/alarms/updates?id=306" class="bare">http://localhost/api/alarms/updates?id=306</a></code>. Because the alarm is no
longer active we do not have a link for force-processing it; instead we
have links for processing it normally with or without comments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc">"updates": [
  {
    "href": "http://localhost:8904/api/alarms/306",
    <strong>"id": "306"</strong>,
    "time": "2016-11-10T14:21:41",
    "message": "Front door has been forced.",
    "source": { "name": "Front door" },
    "type": "Forced Door",
    "priority": 8,
    "state": "unacknowledged",
    <strong>"active": false</strong>,
    "division": { "href": "http://localhost:8904/api/divisions/2" },
    "view": { "href": "http://localhost:8904/api/alarms/306/view" },
    "comment": { "href": "http://localhost:8904/api/alarms/306/comment" },
    "acknowledgeWithComment": { "href": "http://localhost:8904/api/alarms/306/acknowledge" },
    "acknowledge": { "href": "http://localhost:8904/api/alarms/306/acknowledge" },
    "processWithComment": { "href": "http://localhost:8904/api/alarms/306/process" },
    <strong>"process": { "href": "http://localhost:8904/api/alarms/306/process" }</strong>
  }
],
"next": { "href": "http://localhost:8904/api/alarms/updates?id=306.1" }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_updating_after_cutting_power"><a class="link" href="#_updating_after_cutting_power">Updating after cutting power</a></h4>
<div class="paragraph">
<p>This is the result of <code><a href="http://localhost/api/alarms/updates?id=306.1" class="bare">http://localhost/api/alarms/updates?id=306.1</a></code> (the <code>next</code> link from the
previous results) after cutting power to the controller and waiting a minute for Command Centre to
raise an alarm about it.  Nothing has changed on the previous alarms so they do not come out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc">"updates": [
  {
    "href": "http://localhost:8904/api/alarms/308",
    "id": "308",
    "time": "2016-11-10T14:35:21",
    "message": "Controller \"Fat controller\" Offline.",
    "source": { "name": "Fat controller" },
    <strong>"type": "Controller Offline"</strong>,
    "priority": 6,
    "state": "unacknowledged",
    <strong>"active": true</strong>,
    "division": { "href": "http://localhost:8904/api/divisions/2" },
    "view": { "href": "http://localhost:8904/api/alarms/308/view" },
    "comment": { "href": "http://localhost:8904/api/alarms/308/comment" },
    "acknowledgeWithComment": { "href": "http://localhost:8904/api/alarms/308/acknowledge" },
    "acknowledge": { "href": "http://localhost:8904/api/alarms/308/acknowledge" },
    "forceProcess": { "href": "http://localhost:8904/api/alarms/308/process" }
  }
],
"next": { "href": "http://localhost:8904/api/alarms/updates?id=308" }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_updating_after_restoring_power"><a class="link" href="#_updating_after_restoring_power">Updating after restoring power</a></h4>
<div class="paragraph">
<p>Next we GET <code><a href="http://localhost/api/alarms/updates?id=308" class="bare">http://localhost/api/alarms/updates?id=308</a></code> (the <code>next</code>
link from the previous results, again) after restoring power to the
controller and waiting for it to come online.</p>
</div>
<div class="paragraph">
<p>The 'controller offline' alarm (ID 308) has changed to inactive since
the controller has reappeared on the network.</p>
</div>
<div class="paragraph">
<p>The 'low power' alarm has arrived from the controller carrying a timestamp from when it lost mains
power, while it was running on internal reserve power, which was one minute earlier than the
'controller offline' alarm.</p>
</div>
<div class="paragraph">
<p>Bringing up the rear is another alarm that the controller generated when
it restarted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc">{
  "updates": [
    {
      "href": "http://localhost:8904/api/alarms/308",
      "id": "308",
      <b>"time": "2016-11-10T14:35:21"</b>,
      "message": "Controller \"Fat controller\" Offline.",
      "source": { "name": "Fat controller" },
      "type": "Controller Offline",
      "priority": 6,
      "state": "unacknowledged",
      <b>"active": false</b>,
      "division": { "href": "http://localhost:8904/api/divisions/2" },
      "view": { "href": "http://localhost:8904/api/alarms/308/view" },
      "comment": { "href": "http://localhost:8904/api/alarms/308/comment" },
      "acknowledgeWithComment": { "href": "http://localhost:8904/api/alarms/308/acknowledge" },
      "acknowledge": { "href": "http://localhost:8904/api/alarms/308/acknowledge" },
      "processWithComment": { "href": "http://localhost:8904/api/alarms/308/process" },
      "process": { "href": "http://localhost:8904/api/alarms/308/process" }
    },
    {
      "href": "http://localhost:8904/api/alarms/310",
      "id": "310",
      <b>"time": "2016-11-10T14:34:01"</b>,
      "message": "Fat controller - power low.",
      "source": { "name": "Fat controller" },
      "type": "Controller power low",
      "priority": 6,
      "state": "unacknowledged",
      "active": false,
      "division": { "href": "http://localhost:8904/api/divisions/2" },
      "view": { "href": "http://localhost:8904/api/alarms/310/view" },
      "comment": { "href": "http://localhost:8904/api/alarms/310/comment" },
      "acknowledgeWithComment": { "href": "http://localhost:8904/api/alarms/310/acknowledge" },
      "acknowledge": { "href": "http://localhost:8904/api/alarms/310/acknowledge" },
      "processWithComment": { "href": "http://localhost:8904/api/alarms/310/process" },
      "process": { "href": "http://localhost:8904/api/alarms/310/process" }
    },
    {
      "href": "http://localhost:8904/api/alarms/313",
      "id": "313",
      "time": "2016-11-10T14:35:49",
      "message": "Controller \"Fat controller\" restarted after power failed.",
      "source": { "name": "Fat controller" },
      "type": "Power failed",
      "priority": 6,
      "state": "unacknowledged",
      "active": false,
      "division": { "href": "http://localhost:8904/api/divisions/2" },
      "view": { "href": "http://localhost:8904/api/alarms/313/view" },
      "comment": { "href": "http://localhost:8904/api/alarms/313/comment" },
      "acknowledgeWithComment": { "href": "http://localhost:8904/api/alarms/313/acknowledge" },
      "acknowledge": { "href": "http://localhost:8904/api/alarms/313/acknowledge" },
      "processWithComment": { "href": "http://localhost:8904/api/alarms/313/process" },
      "process": { "href": "http://localhost:8904/api/alarms/313/process" }
    }
  ],
  "next": { "href": "http://localhost:8904/api/alarms/updates?id=313" }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That illustrates how events' occurrence times can be out of order when the devices sending them to
the database are out of sync.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_client_side_certificates"><a class="link" href="#_client_side_certificates">Client-side certificates</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>First see <a href="#httpscerts">Authentication and encryption certificates</a> for what certificates are and the
difference between server certificates and client certificates.</p>
</div>
<div class="paragraph">
<p>This section deals with the client certificate check that happens if you
left 'Do not require pinned client certificates' off in the 'Web
Services' property tab of an 8.40 server, or if you entered a thumbprint
into a REST Client item in 8.50 or later.</p>
</div>
<div class="paragraph">
<p>The process in <a href="#_the_request_process">The request process</a> shows that
if you have not disabled client certificate checking, the server does it
after extracting the API key. If the server does not have the client’s
certificate pinned to the REST Client item with that API key, it will
reject the request and raise an alarm:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>A REST connection was attempted with an invalid client certificate</pre>
</div>
</div>
<div class="paragraph">
<p>That alarm will be at the same priority as a controller disappearing off
the network, which should cause a stir, so try not to do it in
production.</p>
</div>
<div class="paragraph">
<p>The next two sections should help you decide whether to use the feature.
The sections following those contain sample command lines that you can
paste into a shell on your clients to create client certificates on disk
or in the Windows certificate store. If you receive syntax errors, you
may have an old version of the software (I have had problems with
<code>New-SelfSignedCertificate</code> on Windows) or the hyphens may not be
hyphens: they may come through as dashes, which look very similar to us
but not to shells. You may have to re-type them.</p>
</div>
<div class="paragraph">
<p>The bold in the sample command lines reduce the protection around your
private key. That may be acceptable in a development environment but for
proper security in a production environment you should omit the bold
parts.</p>
</div>
<div class="sect2">
<h3 id="_what_client_certificate_checking_does"><a class="link" href="#_what_client_certificate_checking_does">What client certificate checking does</a></h3>
<div class="paragraph">
<p>When not disabled by <a href="#_the_mysterious_client_certificate_checkbox">the checkbox</a> in the server
properties, Command Centre requests proof from the client that it has the private key that matches a
public key that the server has configured into it (pinned). A public key is hundreds of bytes so you
don’t want to paste the whole thing into Command Centre’s configuration, and we do not want to
compare all those bytes for each request, so you enter a shorter form instead. It is known as the
certificate’s <em>thumbprint</em> or <em>fingerprint</em> and is a cryptographic hash of the whole
certificate. It is impossible for a client to send a fake certificate with a thumbprint that looks
real.</p>
</div>
<div class="paragraph">
<p>Certificates can also contain a chain of trust linking the certificate
back to a trusted authority. A client uses a server certificate’s chain
of trust to check the identity of the server that responded to its
request. It does not work in reverse: servers do not check that part of
a client’s certificate. You would not have pasted the certificate’s
thumbprint into Command Centre if you did not trust it.</p>
</div>
<div class="paragraph">
<p>When you enter a thumbprint into a CC REST Client’s property page in the
Configuration Client or leave the checkbox we are covering next
unchecked in the server properties, you are saying that only the caller
who has the matching private key is allowed to use that REST Client. In
other words, the client software must possess two secrets that the
server can verify: the API key and the private key.</p>
</div>
<div class="paragraph">
<p>Before getting into why you want all this checking happening, we should
cover how to turn it on. Or, since the product ships with it turned on,
why you should not turn it off.</p>
</div>
<div class="sect3">
<h4 id="_the_mysterious_client_certificate_checkbox"><a class="link" href="#_the_mysterious_client_certificate_checkbox">The mysterious client certificate checkbox</a></h4>
<div class="paragraph">
<p>In 'Server Properties', which you get to in the Configuration Client
starting with the 'File' menu or the top item in your hardware tree,
there is a tab called 'Web Services'. In there, in the box headed by
'Enable REST API', is a checkbox. In 8.40 it was called 'Require pinned
client certificates'. In 8.50 it is called 'Enable REST Clients with no
client certificate'.</p>
</div>
<div class="paragraph">
<p>It behaves like this:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 60%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">8.40</th>
<th class="tableblock halign-left valign-top">'Do not require pinned client certificates' <em>off</em></th>
<th class="tableblock halign-left valign-top">'Do not
require pinned client certificates' <em>on</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection attempt to a REST Client item <em>with</em> a certificate
thumbprint configured</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client certificate checked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client certificate
ignored, connection accepted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection attempt to a REST Client item <em>without</em> a certificate
thumbprint configured</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection rejected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection accepted</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In 8.50, the top-right quadrant changed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 60%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">8.50</th>
<th class="tableblock halign-left valign-top">'Enable REST Clients with no client certificate' <em>off</em></th>
<th class="tableblock halign-left valign-top">'Enable
REST Clients with no client certificate' <em>on</em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection attempt to a REST Client item <em>with</em> a certificate
thumbprint configured</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client certificate checked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>New in 8.50: client
certificate checked</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection attempt to a REST Client item <em>without</em> a certificate
thumbprint configured</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection rejected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection accepted</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>That change will have negatively affected sites that had 'Do not
require…' turned on, but also had thumbprints (uselessly) configured
into their client items. However there is a huge upside to the change:
in 8.50 or later a site can have some clients using client certificates
and some not.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_why_use_client_certificates"><a class="link" href="#_why_use_client_certificates">Why use client certificates?</a></h3>
<div class="paragraph">
<p>To make it harder for an attacker to masquerade as a legitimate REST
client.</p>
</div>
<div class="paragraph">
<p>To do that, they must obtain your API key at the very least. There are
more barriers that you can put up:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">If you:</th>
<th class="tableblock halign-left valign-top">…the black-hat will then have to:</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use a firewall (Windows or hardware)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">be on the server network.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use an IP filter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">spoof the source IP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pin your client’s certificate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">have a copy of the client’s private key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">limit your application privileges</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">settle for less access.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Pinning a client certificate is one more hoop an attacker has to jump
through.</p>
</div>
<div class="paragraph">
<p>You should make viewing your private key very difficult for anything
that does not need it. Do not leave it in the filesystem for anyone to
read! If you are running on Windows, you should use the certificate
store. If you are on another O/S, protect the key while it is on disk
with filesystem permissions and by encrypting it with a password hidden
in your application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_a_certificate_and_record_the_thumbprint_in_cc"><a class="link" href="#_create_a_certificate_and_record_the_thumbprint_in_cc">Create a certificate and record the thumbprint in CC</a></h3>
<div class="paragraph">
<p>The following commands create a client certificate.  You need to run them on the
system that will be running your REST client.  That may not be your Command
Centre server.</p>
</div>
<div class="sect3">
<h4 id="_using_openssl_tools"><a class="link" href="#_using_openssl_tools">Using OpenSSL tools</a></h4>
<div class="paragraph">
<p>This method works equally well on Unix-like or Windows systems with OpenSSL
installed, but the later sections might serve Windows people better because
they show how to put the certificate directly into the Windows certificate
store.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The OpenSSL commands in this section put the private key on disk,
which should make you a bit nervous if you are doing it in production.  On
a Unix-like system you could do it in a mode-0700 folder on a filesystem
that is not backed up and is cleared during a reboot, such as <code>/tmp</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc">openssl req -x509      \
  -newkey rsa:4096     \
  -sha256              \
  <strong>-nodes</strong>               \
  -keyout rest.pem     \
  -out rest.pem        \
  -subj "/CN=RESTtest" \
  -days 3650</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the <code>rsa:4096</code>: it produces a four-kilobit key, which is huge.  It might be
overkill for development, but it&#8217;s nice to have the option.</p>
</div>
<div class="paragraph">
<p>Its name will be 'RESTtest'.  You should come up with a name related to your application&#8217;s purpose
because diagnising certificate problems is a tough enough job without ambiguous certificate names
muddying the waters even more.</p>
</div>
<div class="paragraph">
<p>Again, the bold part is  reducing your security. In this case,
the <code>-nodes</code> option (footnote: it means 'no DES'. It is not the plural
of 'node') means there is no password on the private key. Anyone could
read it from the <code>rest.pem</code> file, so in a production environment you should omit
the <code>-nodes</code> option and type in a password (a really good one) when
<code>openssl req</code> prompts you.</p>
</div>
<div class="paragraph">
<p>To get the thumbprint for Command Centre:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>openssl x509 <span class="nt">-fingerprint</span> <span class="nt">-in</span> rest.pem <span class="nt">-noout</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you protected the PEM with a password, <code>openssl x509</code> will ask you
for it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The 20 bytes that come out are what you paste into the REST Client
item in Command Centre.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you need to add the certificate to the clients that need it. If you use Postman,
see <a href="#_use_the_certificate_in_your_client">Use the certificate in your client</a>. If you use
Chrome on Windows, you need to add it to the certificate store with
these two commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc">openssl pkcs12 -export -in rest.pem -out rest.pfx <b>-passout pass:</b>
explorer rest.pfx</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first command converts the PEM file into a file format that Windows
prefers. The <code>-passout pass:</code> option means it will not put a password on
it, so it is just as dangerous as the PEM file.</p>
</div>
<div class="paragraph">
<p>The second line will open <code>rest.pfx</code> in Explorer (the same as
double-clicking it) to import it into the certificate store. The default
options are good so you can click Next to let it use the current user,
determine the certificate store automatically, and mark the private key as
not exportable).</p>
</div>
<div class="paragraph">
<p>Finally, for goodness’ sake, protect the <code>rest.pem</code> and <code>rest.pfx</code>
files.  Preferably delete them.  Even better, use an eraser utility.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_windows_tools"><a class="link" href="#_using_windows_tools">Using Windows tools</a></h4>
<div class="paragraph">
<p>If your client is on a Windows host there are two more ways to create a
certificate and place it into Windows’s certificate store. Obtaining the
private key from there is easy for your client program but difficult for
anyone else, Microsoft assures us.</p>
</div>
<div class="sect4">
<h5 id="_powershell"><a class="link" href="#_powershell">Powershell</a></h5>
<div class="paragraph">
<p>The topic 'Creating the Client Certificate' in the Configuration
Client’s online help contains instructions for doing it in a PowerShell
with <code>New-SelfSignedCertificate</code>. Handily, it prints the thumbprint to
the console so you can copy it into Command Centre. You should try that
first, since it is simplest. But <code>New-SelfSignedCertificate</code> is not
present on all versions of Windows, so here is an alternative using…</p>
</div>
</div>
<div class="sect4">
<h5 id="_makecert"><a class="link" href="#_makecert">makecert</a></h5>
<div class="paragraph">
<p>…which has been around for longer.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run a developer command prompt as administrator. If you do not have a developer command prompt,
try a regular command prompt (as administrator).</p>
</li>
<li>
<p>In it:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="go">makecert ignoreme.der
         -a sha1
         -ss My
         -sky signature
         <strong>-pe</strong>
         -len 2048
         -n "CN=RESTClientCert"
         -sr CurrentUser</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That will create a certificate and place it in your certificate store
with a copy on disk.</p>
</div>
<div class="paragraph">
<p>Its name will be 'RESTClientCert'.  As previously indicated, you should come up with an informative
name for your certificates so that the brave souls diagnosing your TLS issues have something to
go on.</p>
</div>
<div class="paragraph">
<p>The <code>-pe</code> marked the key as exportable.  More on that later.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>You do not need to keep the file <code>ignoreme.der</code>, but the easiest way to
get the thumbprint of your new certificate is to open <code>ignoreme.der</code> by
double-clicking on it in Explorer, go to the Details tab, scroll to the
bottom, and click the thumbprint. You could then skip the next three
steps, but when starting out it is a good idea to perform these steps to assure yourself
that <code>makecert</code> put your new certificate where it should have.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Run <code>mmc</code>, add the Certificates snap-in to manage "My user account,"
open it and then expand your "Personal" certificates.</p>
</li>
<li>
<p>Ensure you can see a certificate called (issued to) 'RESTClientCert' in there.
This is the cert you will pick for your browser later.</p>
</li>
<li>
<p>Double-click it, go to the Details tab, scroll to the bottom, and
click the thumbprint.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Those are the 20 bytes / 40 characters that you paste into the REST Client item in Command Centre.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_aside_other_ways_of_calculating_the_thumbprint"><a class="link" href="#_aside_other_ways_of_calculating_the_thumbprint">Aside: other ways of calculating the thumbprint</a></h5>
<div class="paragraph">
<p>For your information, here are three more command-line options for
extracting the thumbprint from the DER file if you didn’t get it above.
They all do the same thing. Use whichever works for you:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl x509 -in ignoreme.der -inform der -noout -fingerprint
openssl sha1 ignoreme.der
sha1sum ignoreme.der</pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the last two, a certificate thumbprint is really
just the SHA1 hash of the certificate when it is stored in a DER file.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Some utilities, inluding openssl, print a thumbprint with colons separating each octet.
Take the colons out before pasting that into the REST Client item, otherwise your client will not be
able to make calls through the cloud API gateway.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_marking_keys_as_exportable"><a class="link" href="#_marking_keys_as_exportable">Marking keys as exportable</a></h5>
<div class="paragraph">
<p>The <code>-pe</code> option to your <code>makecert</code> command above marked your private
key as exportable.</p>
</div>
<div class="paragraph">
<p>You can mark it as not exportable so that the standard utilities will not
be able to get it out of the certificate store. That sounds like a good
idea, because (while there are programs out there that export
non-exportable certificates) anything you can do to make the black-hat’s
job harder is a win.</p>
</div>
<div class="paragraph">
<p>If you used the command <code>New-SelfSignedCertificate</code> in Windows
Powershell (using the instructions in the Configuration Client’s user
guide), you can mark the certificate not exportable by adding
<code>-KeyExportPolicy NonExportable</code> to the command line.</p>
</div>
<div class="paragraph">
<p>The trouble is that in order to use your client certificate in Postman,
you have to export the key.</p>
</div>
<div class="paragraph">
<p>If you used <code>makecert</code>, remove the <code>-pe</code> and your new key will not be
exportable.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_extract_the_certificate_and_private_key_from_the_windows_store_to_disk"><a class="link" href="#_extract_the_certificate_and_private_key_from_the_windows_store_to_disk">Extract the certificate and private key from the Windows store to disk</a></h4>
<div class="paragraph">
<p>If you are going to use Postman you need to give it files containing
your private key and certificate, but if you are on Windows and used one of the Windows
utilities to create a new certificate in the certificate store,
you will not have the private key on disk. You will need to extract it.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run mmc. Certificates &#8594; Current User &#8594; Personal &#8594; Certificates.</p>
</li>
<li>
<p>Right-click your certificate &#8594; All tasks &#8594; Export…<br>
Select the option to export the private key. Give it a password,
otherwise openssl cannot decrypt it.<br>
It does not matter what you do with the other certificates, so leave the
defaults set.<br>
Export it to a <code>.pfx</code> file on disk.</p>
<div class="paragraph">
<p>That PFX file is partly secure because you put a password on it, but I expect
that password was very short so, again, be careful what you do with that
file.</p>
</div>
</li>
<li>
<p>For old versions of Postman you may have to convert that PFX into a
file it understands. The current version of Postman does not need this:</p>
<div class="literalblock">
<div class="content">
<pre>$ openssl pkcs12 -in restexported.pfx –out rest.pem <strong>–nodes</strong></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>It will ask you for the password you picked for the export. It will put
the certificate and the private key in the PEM file, unencrypted
(because of <code>-nodes</code>). It is plain text: you can look at it in Notepad.</p>
</div>
</div>
<div class="sect3">
<h4 id="_an_easy_but_not_so_secure_way_to_discover_your_client_certificates_thumbprint"><a class="link" href="#_an_easy_but_not_so_secure_way_to_discover_your_client_certificates_thumbprint">An easy (but not so secure) way to discover your client certificate’s thumbprint</a></h4>
<div class="paragraph">
<p>Create a client certificate using one of the methods above and use it in
an API call. The server should raise an alarm, complaining that 'a REST
connection was attempted with an invalid client certificate'. The rest
of that message will tell you which REST Client Item you need to put the
thumbprint on, and the alarm&#8217;s details string will contain the thumbprint
itself.</p>
</div>
<div class="paragraph">
<p>If the thumbprint is <code>(null)</code>, your client did not send a certificate
at all.</p>
</div>
<div class="paragraph">
<p>Otherwise, copy the thumbprint straight out of there and paste it into
the item. The next time you try your call the server should not complain
about the certificate.</p>
</div>
<div class="paragraph">
<p>The reason this method is not so secure is that you might not be sure that
the alarm was yours. Someone else may have hit the API before you did.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_use_the_certificate_in_your_client"><a class="link" href="#_use_the_certificate_in_your_client">Use the certificate in your client</a></h3>
<div class="sect3">
<h4 id="_postman"><a class="link" href="#_postman">Postman</a></h4>
<div class="paragraph">
<p>The standalone version of Postman cannot read certificates out of the
certificate store (footnote: the Chrome extension can, but that version of
Postman is no longer under development).</p>
</div>
<div class="paragraph">
<p>Go to the cog &#8594; Settings &#8594; Certificates.  Add the certificate that
Postman should use when talking to your server and port.  Where Postman
asks for the CRT file, give it the file containing the certificate.  Where
Postman asks for the key file, give it the file containing the private key.
They will both be the same file if you followed the example above.</p>
</div>
<div class="paragraph">
<p>If you protected your private key with a password (a good idea, but turned
off by <code>-nodes</code>), give it to Postman.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="assets/postman_client_cert.png" alt="Tell Postman which client cert to use">
</div>
<div class="title">Figure 18. Tell Postman which client cert to use</div>
</div>
<div class="paragraph">
<p>Now Postman will use that certificate when it talks to Command Centre.
If you put the certificate’s thumbprint on the REST Client item with the
API key Postman is using, you can turn on pinned certificates in the
server properties and Postman will still be able to connect.</p>
</div>
<div class="paragraph">
<p>You can leave Postman using this certificate no matter whether CC has
pinned certificates turned off or on: it does no harm.</p>
</div>
</div>
<div class="sect3">
<h4 id="_chrome"><a class="link" href="#_chrome">Chrome</a></h4>
<div class="paragraph">
<p>When you first try to connect to Command Centre using Chrome it will
give you a list of certificates in the store and ask you which to use.
Select the one you just put there.</p>
</div>
</div>
<div class="sect3">
<h4 id="_wget"><a class="link" href="#_wget">wget</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>wget                                                                        <span class="se">\</span>
<span class="go">    <strong>--no-check-certificate</strong>                                                    \
    --certificate=<em>your_pem_file</em>                                               \
    --header="Authorization: GGL-API-KEY <em>your-API-key</em>"                        \
    https://localhost:8904/api</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--no-check-certificate</code> turns off client-side checking of the
server certificate.</p>
</div>
<div class="paragraph">
<p>Careful: my version of wget does not complain if it cannot read the
certificate file.</p>
</div>
</div>
<div class="sect3">
<h4 id="_curl"><a class="link" href="#_curl">curl</a></h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>curl                                                                        <span class="se">\</span>
<span class="go">    --verbose                                                                 \
    <strong>--insecure</strong>                                                                \
    --cert <em>your_pem_file</em>                                                      \
    --header "Authorization: GGL-API-KEY <em>your-API-key</em>"                        \
    https://localhost:8904/api</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--insecure</code> turns off client-side checking of the server
certificate.</p>
</div>
<div class="paragraph">
<p>I found <code>--verbose</code> necessary to see error codes.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_server_side_certificates"><a class="link" href="#_server_side_certificates">Server-side certificates</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A client in a production environment should refuse to talk to a server that it does not recognise.
"Recognising" a server means either</p>
</div>
<div class="ulist">
<ul>
<li>
<p>having a copy of its certificate on the client already (which is the same as the client
certificate pinning covered in the previous section, only it is the client doing it to the server
instead of the server doing it to the client), or</p>
</li>
<li>
<p>having a trusted Internet authority&#8217;s signature on the certificate.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<strong>Production clients should check server certificates.</strong> If not, an attacker could
masquerade as the server.  The client would send it its API key to the fake server, and the attacker
could&#8212;&#8203;if the real server was not checking client certificates&#8212;&#8203;use it for calls of its own.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>But if you are working in a development rig and your server does not have a signed certificate, you
might like to tell your client to skip the server certificate check, as you told Chrome and Postman
to do earlier.</p>
</div>
<div class="paragraph">
<p>If you will pardon a very brief dive into source code, here is one way to do it in a C# client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="n">ServicePointManager</span><span class="p">.</span><span class="n">ServerCertificateValidationCallback</span> <span class="p">=</span> <span class="k">delegate</span> <span class="p">(</span>
    <span class="kt">object</span> <span class="n">s</span><span class="p">,</span>
    <span class="n">X509Certificate</span> <span class="n">certificate</span><span class="p">,</span>
    <span class="n">X509Chain</span> <span class="n">chain</span><span class="p">,</span>
    <span class="n">SslPolicyErrors</span> <span class="n">sslPolicyErrors</span><span class="p">)</span>
  <span class="p">{</span> <span class="k">return</span> <span class="k">true</span><span class="p">;</span> <span class="p">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do not have control of the client application, or you wish to check the server certificate
(which is advisable), here are a couple of approaches to making the check succeed.</p>
</div>
<div class="paragraph">
<p>You only need one of these.</p>
</div>
<div class="sect2">
<h3 id="_pin_the_server_certificate_on_the_client"><a class="link" href="#_pin_the_server_certificate_on_the_client">Pin the server certificate on the client</a></h3>
<div class="paragraph">
<p>Go to Server Properties in Command Centre&#8217;s configuration client, then Web Services &#8594; Manage
Certificates, and click View on whichever type of certificate you are using. Go to the Details tab
in the window that appears, then choose Copy to File. You have a few choices for the format to
export it to. DER is good for Windows machines, but a PFX&#8212;&#8203;if that option is enabled&#8212;&#8203;might be
more widely accepted on non-Windows systems. If you are ever asked if you want to export the private
key, <em>just say "no"</em>.</p>
</div>
<div class="paragraph">
<p>Once you have your certificate file on disk, copy it to the client
machine. Provided you didn’t let a private key get in there, it is not a
secret.</p>
</div>
<div class="paragraph">
<p>How you install it on the client depends on the client. On a Windows
box, it may be as simple as double-clicking it. The Certificate Import
Wizard will ask you where to install it: you probably want Trusted Root
Certificate Authorities. That is a bit of a sledgehammer, because it
makes not only your REST client but every client on that host trust that
certificate. Plus, they will trust any other certificate signed by it.
But it will get you going.</p>
</div>
<div class="paragraph">
<p>You have more options if you are writing your own client.  You might like to have a copy of the
server&#8217;s certificate on disk to compare against.  A certificate is large, so the usual approach is
to record a hash of it instead.  It is not a secret but you must prevent anything from changing it,
because when your client connects to the server you want to hash the server&#8217;s certificate again and
compare it to the value you have on record.  If they are not the same, don&#8217;t trust the server.</p>
</div>
<div class="paragraph">
<p>Windows calls the SHA1 hash of certificate its <em>thumbprint</em>, and presents it in the Details tab of
the window the first paragraph took you to:  Server Properties &#8594; Web Services &#8594; Manage
Certificates &#8594; View &#8594; Details.  You&#8217;ll find the thumbprint at the bottom of the field list (you
will have to scroll).</p>
</div>
</div>
<div class="sect2">
<h3 id="_buy_a_signed_certificate_for_the_server"><a class="link" href="#_buy_a_signed_certificate_for_the_server">Buy a signed certificate for the server</a></h3>
<div class="paragraph">
<p>If that method does not
suit, perhaps because you do not have control of the clients, you could
buy a "real" certificate for your CC server. One drawback is that
signatures eventually expire, requiring you to do this every year or
three. Another is that you must buy a new certificate if you change the
name of your server.  So, use a DNS alias.</p>
</div>
<div class="paragraph">
<p>This is nothing new for REST APIs: it is the process that every web
site owner goes through. If you want to sell scones and Toby mugs from
www.itsabritishthing.com, for example, you:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>generate a certificate for www.itsabritishthing.com,</p>
</li>
<li>
<p>generate a certificate signing request (a CSR) from that certificate,</p>
</li>
<li>
<p>decide which signing authority to use,</p>
</li>
<li>
<p>send the CSR to that signing authority, with your credit card details and proof that you own
itsabritishthing.com,</p>
</li>
<li>
<p>wait for them to send you your new certificate, then</p>
</li>
<li>
<p>install it on your web server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>That is exactly what you will need to do for Command Centre. Start with
the DNS alias for your server instead of www.itsabritishthing.com. The
next few steps are a Googling exercise for the reader because they
depend on which authority you choose. Finish with a simple process
covered in the section called "Replacing the web service certificate"
of the Configuration Client’s user guide. Briefly, it is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to Server properties &#8594; Web Services &#8594; Manage Certificates in the REST API section,</p>
</li>
<li>
<p>change the radio box to Custom Certificate,</p>
</li>
<li>
<p>click Import, and</p>
</li>
<li>
<p>browse to your certificate file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At time of writing, Gallagher Group has no association with
www.itsabritishthing.com.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_command_centre_items"><a class="link" href="#_other_command_centre_items">Other Command Centre items</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Version 8.00 added fence zones, access zones, alarm zones, doors,
macros, and outputs (relays and LEDs) under two licences. The RESTStatus
licence lets you see their status and some basic configuration, and the
RESTOverrides licence lets you send overrides to them. So you can open
doors, run macros, disarm fence and alarm zones, toggle outputs, and so
on. Version 8.10 added inputs, which are often connected to physical
devices such as reed switches and infrared sensors. Version 8.30 added a
method <code>/api/items/updates</code> which lets you monitor several items with
one connection. Version 8.50 added operator groups, schedules, and day
categories.</p>
</div>
<div class="paragraph">
<p>Note that the REST API does not let you create, edit, or delete any of
these items except schedules. The configuration client is still the
place for that.</p>
</div>
<div class="paragraph">
<p>Each of those item types has its own controller, its own block of links
in <code>/api</code>, and its own section in the developer documentation.
Schedules, day categories, and the items with status like zones and
hardware have their documentation under "Status and Overrides".
Because the <code>items/updates</code> method is on the items controller it in with
Alarms and Events. Operator groups are in with cardholders.</p>
</div>
<div class="paragraph">
<p>As an example of how to use these APIs, here is how you would list all
your doors and get the link to open one of them:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>GET /api
// You would find and use the URL at features.doors.doors.href, which in 8.30 is:
GET /api/doors
// To search for one door use the 'name' parameter:
GET /api/doors?name="Greendoor"
// But if all you intend to do is open it, you only need the override links:
GET /api/doors?name="Greendoor"&amp;fields=commands</pre>
</div>
</div>
<div class="sect2">
<h3 id="_overriding_items"><a class="link" href="#_overriding_items">Overriding items</a></h3>
<div class="paragraph">
<p>To send an override to an item you make an HTTP POST to a URL that you
get from the item itself.</p>
</div>
<div class="paragraph">
<p>The output from the last example above, that requested the <code>commands</code>
block of the door called 'Greendoor', is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="nl">"results"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"commands"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"open"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/doors/507/open"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"free"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_zones/533/free"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"freeUntil"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_zones/533/free"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"freePin"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_zones/533/free_pin"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"freePinUntil"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_zones/533/free_pin"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"secure"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_zones/533/secure"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"secureUntil"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_zones/533/secure"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="c1">// ... ten more commands omitted for brevity ...</span><span class="w">
      </span><span class="nl">"cancel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"href"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://localhost:8904/api/access_zones/533/cancel"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Normally a search would return an ID, href, and name, and it would not
return that block of commands, but we turned that on its head by using
the <code>fields</code> query parameter to request the <code>commands</code> block and nothing
else. Each of the objects inside it is a named command containing an
href which, when you POST to it, sends an override to the item. For
example, if that was a door on your system and you pasted the URL from
<code>commands.open</code> into Postman, and POSTed it, the unlock relay on that
door would fire.</p>
</div>
<div class="paragraph">
<p>Each item type has a different set of commands you can send it. They
vary in type and number: outputs have four and access zones have 21.
Most of those access zone overrides are also available on the zone’s
doors, for convenience.</p>
</div>
<div class="paragraph">
<p>Overrides don’t need anything in the body of the POST, but those with
'Until' in the name of the command will use a timestamp if you send it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="c1">// POST /api/access_zones/533/free</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"endTime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2020-03-06T00:00:00Z"</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That example would put the door’s entry access zone in free mode until
midnight March 6.</p>
</div>
</div>
<div class="sect2">
<h3 id="_status_flags"><a class="link" href="#_status_flags">Status flags</a></h3>
<div class="paragraph">
<p>Just as each item type has its own commands, each also has its own set
of status flags. A door can be open or closed, for example, while an
access zone can be secure or free. Each also has its own set of flag
rules that they will always follow. Doors, inputs, and outputs are quite
simple but fence zones have half a dozen rules thanks to the voltages
they deal with.</p>
</div>
<div class="paragraph">
<p>The developer documentation clearly lays out all the status flags items
can return, and their rules. For example, here is part of the section on
outputs:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>If the output is online, its <code>statusFlags</code> field may contain one or more
of these flags:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>relayStateUnknown</code> means the controller does not know what the output should be doing.</p>
</li>
<li>
<p><code>closed</code> means the output relay is closed.</p>
</li>
<li>
<p><code>open</code> means the output relay is open.</p>
</li>
<li>
<p><code>pulsed</code> means the relay’s change in state is momentary.</p>
</li>
<li>
<p><code>switchingDisabled</code> means switching this output is disabled.</p>
</li>
<li>
<p><code>overridden</code> means the output is under the effect of an override.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If and only if the output is online, one of <code>relayStateUnknown</code>,
<code>closed</code>, or <code>open</code> will appear. Of the above, only <code>overridden</code> can
appear when the output is offline.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The above tells you that the first flags you should look for are
<code>relayStateUnknown</code>, <code>closed</code>, and <code>open</code>. If none of those is in the
flag set then your output is offline. Other flags will tell you what the
problem is, if you want to go deeper, but it is probably enough for your
integration to know that the output’s state is uncertain and it should
subscribe to updates in case that changes.</p>
</div>
<div class="paragraph">
<p>At last count there were eleven status flags common to all items. Some
are not so serious, like the flags that indicate the item is shunted
(muted) or is not fully configured yet. Others indicate an actual
problem like a network outage, a cable fault, or a service not running.
The developer documentation covers them all (search for 'abnormal
status').</p>
</div>
<div class="paragraph">
<p>There is a lot more on the topic in the reference documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_subscribing_to_updates_one_item_at_a_time_pre_8_30_todo"><a class="link" href="#_subscribing_to_updates_one_item_at_a_time_pre_8_30_todo">Subscribing to updates (one item at a time, pre-8.30) TODO</a></h3>
<div class="paragraph">
<p>This section TODO. What follows is a broad outline of what the section
should contain.</p>
</div>
<div class="paragraph">
<p>GET the <code>updates</code> link on an item’s details page. It is a long poll, so
the server won’t respond until it has something for you (or it times out
after about 50s). Then stay up to date by entering a loop GETting the
<code>next</code> link.</p>
</div>
<div class="paragraph">
<p>You really should be using bulk item updates, in the section below, because this method requires one
TCP connection per monitored item. Why use this?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You’re not running 8.30 yet, or</p>
</li>
<li>
<p>you’re monitoring only one item and want a slightly simpler call, or</p>
</li>
<li>
<p>your client wants to wait longer than 30s between GETs (but it is hard
to imagine a client needing that).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_subscribing_to_updates_many_items_8_30_todo"><a class="link" href="#_subscribing_to_updates_many_items_8_30_todo">Subscribing to updates (many items, 8.30+) TODO</a></h3>
<div class="paragraph">
<p>A rough outline: GET <code>/api</code> then POST a document to the link at
<code>features.items.updates</code> (which is <code>/api/items/updates</code> in 8.30, but may
change, which is why you should use the page at <code>/api</code>).</p>
</div>
<div class="paragraph">
<p>The body of your POST should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="p">{</span><span class="w">  </span><span class="nl">"itemIds"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"508"</span><span class="p">,</span><span class="w"> </span><span class="s2">"526"</span><span class="p">]</span><span class="w">  </span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Those numbers are item IDs. Even though they look like integers they
must be in quotes because in the future they could contain alphas. Place
as many in the array as you like. We tested 1,000 without it affecting
performance.</p>
</div>
<div class="paragraph">
<p>The POST will return with the status of all your items and a next link.
GET that link, and keep GETting it in a loop to stay up to date. The
calls will block if there are no changes to report. Sleep between calls
to avoid tight loops. But not longer than 30s, otherwise the server will
drop your session, thinking you have walked away.</p>
</div>
<div class="paragraph">
<p>The first GET will return the same states that the POST did, which seems
redundant, but that is just the way it is. Just keep looping.</p>
</div>
<div class="paragraph">
<p>This is a far better way of monitoring multiple items that the previous
because it only uses one server connection per client.</p>
</div>
<div class="paragraph">
<p>At time of writing (8.80) this is the only API call that maintains state
between calls.  All the others require their context to arrive with the
query.</p>
</div>
</div>
<div class="sect2">
<h3 id="_schedules_and_day_categories_todo"><a class="link" href="#_schedules_and_day_categories_todo">Schedules and day categories TODO</a></h3>
<div class="paragraph">
<p>Schedules arrived in 8.40. The API lets you view, create, and delete them, and
modify how they affect their items. It does not let you change the items
they affect.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you are not familiar with Command Centre:</p>
</div>
<div class="paragraph">
<p>There are seven types of schedule.  They all contain a list of day
categories (more on those later), and for each day category, a list of
times (00:00 through 23:59) paired with an action to perform at that time.</p>
</div>
<div class="paragraph">
<p>Where the schedule types differ is in the item types they can control, and
the actions that they trigger on the item they are controlling.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schedule type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Actions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cardholder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access granted / denied</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access zone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zone mode (secure, free, etc.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alarm zone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zone mode (armed, disarmed, etc.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On / off / cancel overrides</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notifications</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On / off</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HV/LF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High / low / cancel overrides</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Elevator kiosk</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control mode</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The access zone and alarm zone schedules can switch their zone to any mode.
The other five select between two modes.</p>
</div>
<div class="paragraph">
<p>Some of them have another action that cancels any untimed overrides that
happened since the last scheduled changed, returning control back to the
schedule.  It won&#8217;t affect overrides that have an end time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When updating a schedule you must replace its entire list of day
categories and times. This is quite different from how you update other
lists via this API. The JSON schema has room for us to accept the normal
style as a future enhancement, but in 8.40 you must replace all a
schedule’s schedules at the same time. That suits our target use-case,
which is for an integration to download the schedule, de-serialise it
into an object model, change some part of it, then re-serialise and
upload it back.</p>
</div>
<div class="paragraph">
<p>As of 8.80, the only types of item that the API can create are
cardholders, visits, and schedules.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_visitor_management"><a class="link" href="#_visitor_management">Visitor management</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_2"><a class="link" href="#_introduction_2">Introduction</a></h3>
<div class="paragraph">
<p>The Command Centre Visitor Management feature allows you to manage <em>visit</em> items. A visit contains</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a list of expected <em>visitor</em> cardholders,</p>
</li>
<li>
<p>a <em>host</em> cardholder, responsible for a visitor while on site,</p>
</li>
<li>
<p>a <em>reception</em>, which is a location at which visitors may arrive,</p>
</li>
<li>
<p>a <em>visitor type</em>, that serves two purposes:  an access group that Command Centre will add
your visitors to when you add them to the visit, and an index into more visitor management
configuration,</p>
</li>
<li>
<p>a list of <em>visitor access groups</em> that your visitors need to be in while on site,</p>
</li>
<li>
<p>other flat fields such as the dates of the visit and a description.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The host is person who Command Centre should notify when a visitor
signs in. If a visitor does not have a card, tag boards and reports will
show them in the same access zone as their host. A cardless visitor
appears to follow his or her host around the site, in other words.</p>
</div>
<div class="paragraph">
<p>The visitor type (an access group) is there so that visitors can have
PDF values assigned before they arrive. This is useful for aids to
identification such as photos and driver’s licence or passport numbers.
Recall that in order to hold a value for a PDF, a cardholder must be in
one of the PDF’s access groups.</p>
</div>
<div class="paragraph">
<p>The visitor access groups (not the visitor <em>type</em> access group) are
there so that after a visitor signs in they can open doors using a card.
No access groups: no access.</p>
</div>
</div>
<div class="sect2">
<h3 id="_capabilities_of_the_api"><a class="link" href="#_capabilities_of_the_api">Capabilities of the API</a></h3>
<div class="paragraph">
<p>The API lets you read the relevant parts of visitor management
configuration, list receptions, and CRUD visit items, including their
visitors.</p>
</div>
<div class="paragraph">
<p>It does not let you change visitor management configuration. You do
that on divisions in the Configuration Client.</p>
</div>
<div class="paragraph">
<p>v8.90 lets you sign visitors in or out and mark them on or off site.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_command_centre_to_use_visitor_management_via_the_api"><a class="link" href="#_setting_up_command_centre_to_use_visitor_management_via_the_api">Setting up Command Centre to use Visitor Management via the API</a></h3>
<div class="paragraph">
<p>To use the Visitor Management feature, you must:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add some visitor management configuration to a division in the Configuration Client, including at
least one visitor type (access group) with at least one <em>host type group</em> and <em>visitor access
group</em>, and</p>
</li>
<li>
<p>create at least one reception item in the same division, again in the Configuration Client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your software can then use the API to get that division configuration
and the list of receptions. When it creates a visit it will need to
comply to the rules in the division configuration, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the visit’s visitor type access group must be in the same division as the visit’s reception,</p>
</li>
<li>
<p>the visit’s visitor type must be one of the division’s visitor types,</p>
</li>
<li>
<p>the visit’s host must be a member of at least one of that visitor type’s host access groups,</p>
</li>
<li>
<p>the visit’s visitor access groups must be a subset of that visitor type’s visitor access groups.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The division in question is the visit’s reception’s division.</p>
</div>
<div class="paragraph">
<p>Command Centre reevaluates its rules every time you change a visit. We
aimed to provide useful error messages, so if you receive anything
except a 200-level response code please look in the body.</p>
</div>
<div class="paragraph">
<p>When you add a visitor to a visit, Command Centre will add that
cardholder to the visit’s visitor type access group. Then you can add
PDFs to the cardholder (such as an image). When the cardholder signs in
using a Gallagher Visitor Management Kiosk, or when a greeter signs them
in using the Visitor Management Client, Command Centre will add the
visitor to the visit’s visitor access groups.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_api_gateway"><a class="link" href="#_the_api_gateway">The API gateway</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The API gateway lets clients connect to the server when they cannot reach its port 8904 directly.
Command Centre needs to be connected to a cloud server, and it needs to turn on the API gateway
globally and in each REST Client item that needs it (which only takes a few clicks) then the client
simply changes the host and port in its connection URL to the cloud server that the Command Centre
server is connected to.  That is most likely to be one of these two:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Australia</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">commandcentre-api-<strong>au</strong>.security.gallagher.cloud</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">United States</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">commandcentre-api-<strong>us</strong>.security.gallagher.cloud</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The port (8904, unless you changed it from the factory setting) also has to go because the gateway
listens on the default port for HTTPS, 443.</p>
</div>
<div class="paragraph">
<p>Everything else is the same, including the API key, the client certificate, the root path (<code>/api</code>),
and the documentation URL <a href="https://gallaghersecurity.github.io" class="bare">https://gallaghersecurity.github.io</a>.</p>
</div>
<div class="paragraph">
<p>The request&#8217;s source IP number will <em>not</em> be that of your client host by the time the request
arrives at our gateway.  It will be the internal address of one of Amazon&#8217;s load balancers, so you
will need to untick 'Enable IP Filtering' when you move from the Command Centre server to the API
gateway.</p>
</div>
<div class="paragraph">
<p>There are no additional licence requirements for the API gateway.</p>
</div>
<div class="paragraph">
<p>Note that due to the traffic hairpinning through Amazon&#8217;s servers, throughput is significantly
reduced.</p>
</div>
<div class="paragraph">
<p>For a lot more detail about the API gateway, see its technical information paper at
<a href="https://gallaghersecurity.github.io/docs/Command%20Centre%20Cloud%20Api%20Gateway%20TIP.pdf" class="bare">https://gallaghersecurity.github.io/docs/Command%20Centre%20Cloud%20Api%20Gateway%20TIP.pdf</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_notes_for_penetration_testers"><a class="link" href="#_notes_for_penetration_testers">Notes for penetration testers</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section contains answers to questions raised after penetration tests.</p>
</div>
<div class="paragraph">
<p>Also see <a href="#_the_request_process">The request process</a> for how the server authenticates and authorises requests.</p>
</div>
<div class="sect2">
<h3 id="_item_ids_are_easily_predicted"><a class="link" href="#_item_ids_are_easily_predicted">Item IDs are easily predicted</a></h3>
<div class="paragraph">
<p>All Command Centre&#8217;s items are referenced by a URL containing the item&#8217;s database ID, which is a
small integer.  It is trivially easy to generate the URL ("href") of every item in the system by
starting at ID number one and iterating up.  Some tests flag this as an issue.</p>
</div>
<div class="paragraph">
<p>We expect attackers to do this.  We do not rely on a client&#8217;s ignorance of server state to protect
it (other than API keys, of course).  The server will always enforce the licensing and privilege
models.  For example, when a client asks for the details of an item it is unable to view the server
will respond as though the item does not exist (with a 404).</p>
</div>
<div class="paragraph">
<p>The external penetration testers Gallagher engages have access to our source code so that they can
conduct white-box testing and fully exercise the privilege model.  Their reports are available on
request.</p>
</div>
</div>
<div class="sect2">
<h3 id="_there_is_no_rate_limiting_of_authorised_requests"><a class="link" href="#_there_is_no_rate_limiting_of_authorised_requests">There is no rate-limiting of authorised requests</a></h3>
<div class="paragraph">
<p>The API does not throttle correctly-authenticated API requests, which makes it look like it is not
protecting itself from denial-of-service attacks.</p>
</div>
<div class="paragraph">
<p>It protects itself from incorrectly-authenticatd API requests.  It raises medium-priority alarms for
the first few bad requests, then another at the highest priority to inform operators that it is
under a DoS, after which it falls silent until the attack ends.</p>
</div>
<div class="paragraph">
<p>We are looking at options for rate-limiting the API, but it is a balance between protecting
the server from an unlikely situation and preserving the normal operation of our integrations, some
of which make a huge number of requests per second.</p>
</div>
<div class="paragraph">
<p>We consider a DoS attack from a fully-authenticated bad actor (in other words, one with a valid API
key, TLS certificate, and source IP) is not likely enough to justify urgency.</p>
</div>
<div class="paragraph">
<p>So far, the denials of service our customers have observed were caused by authenticated integrations
acting improperly.  To help developers avoid that the reference documentation contains sections
headed "efficiency tips".</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_server_uses_the_host_header"><a class="link" href="#_the_server_uses_the_host_header">The server uses the Host header</a></h3>
<div class="paragraph">
<p>Our web server uses the Host header sent by the client to form URLs that it sends back.  Although
the server does not change its behaviour based on the header&#8217;s value, using it to build strings is
enough to cause a negative result on some tests.</p>
</div>
<div class="paragraph">
<p>A client sending a malformed Host header will only affect itself. This would be a problem if an
attacker was modifying (poisoning) a valid request on its way to us, but if the attacker could do
that it would have observed a valid API key and TLS certificate, plus it would be able to pollute
our responses on their way back to the client, so it would hardly bother with this attack.</p>
</div>
<div class="paragraph">
<p>This class of vulnerability is a problem when there is an HTTP cache between client and server.
This is never the case for program interfaces.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_monitoring_the_api"><a class="link" href="#_monitoring_the_api">Monitoring the API</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The web server presents its vital statistics in Windows performance counters, and (optionally)
writes every API call to a log file.</p>
</div>
<div class="sect2">
<h3 id="_performance_counters"><a class="link" href="#_performance_counters">Performance Counters</a></h3>
<div class="paragraph">
<p>Every API call increments a Windows Performance counter called 'REST API Request Rate'.  You can
find it, along with other performance counters updated by Command Centre&#8217;s other API servers, in a
category called 'Gallagher Command Centre'.  That counter will give you a view of how many calls the
API is receiving.</p>
</div>
<div class="sect3">
<h4 id="_per_client_performance_counters"><a class="link" href="#_per_client_performance_counters">Per-client performance counters</a></h4>
<div class="paragraph">
<p>If you are running 8.90 or later, another category called 'Gallagher Command Centre REST clients'
contains counters that will show you which of your clients are hitting the API the hardest.  They
are called 'Requests per second' and 'Total processing time (ms)' each with an <em>instance</em> for each
REST Client item in Command Centre.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
An <em>instance</em> of a performance counter is one created at run-time to suit to the environment.
They are the lowest tier in the hierarchy: category, counter, instance.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In our case, the environment is a pool of REST clients so CC creates an instance for the REST Client
item the first time an API call arrives for that item (i.e., the first time an API call arrives with
that item&#8217;s API key in its Authorization header).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The instance takes the name that the client item had when the session was first created, which
is also when all its privileges were calculated.  If you rename a REST Client item and notice that
no new performance counter appears, that&#8217;s why.  Click on the 'Refresh Operator privileges' button
in the item&#8217;s configuration page if you need it to update smartly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also note that some characters are not permitted in the name of a performance counter, so the server
may have adjusted them to suit.</p>
</div>
</div>
<div class="sect3">
<h4 id="_per_route_performance_counters"><a class="link" href="#_per_route_performance_counters">Per-route performance counters</a></h4>
<div class="paragraph">
<p>The 'Gallagher Command Centre API routes' category, also added to 8.90, will show you which API
routes (a.k.a. endpoints) are the most popular.  It contains counters called 'Requests per second'
and 'Total processing time (ms)' again but this time each has one instance for each API route.</p>
</div>
<div class="paragraph">
<p>Only routes that a client has called will have a counter.</p>
</div>
<div class="paragraph">
<p>Like client names, API routes have their URLs heavily modified to become suitable performance
counter names and to make them more readable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_word_of_warning_about_processing_times"><a class="link" href="#_a_word_of_warning_about_processing_times">A word of warning about processing times</a></h4>
<div class="paragraph">
<p>The processing time that comes out of these counters for an API call does not necessarily reflect
the CPU or I/O cost of that call.  It is simply the difference in wall-clock times before and after.
If the operation the client requested had to wait for a resource, such as a lock, then the call will
look expensive even though it spent part of its time in a queue.</p>
</div>
<div class="paragraph">
<p>Therefore these processing times only represent the true cost of an operation when the server and
database were able to give it their full attention.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_access_log"><a class="link" href="#_access_log">Access log</a></h3>
<div class="paragraph">
<p>Servers 8.90 and later write a line to an access log for every API request.</p>
</div>
<div class="paragraph">
<p>It is controlled by a DWORD value called <code>LogRESTRequests</code> inside the registry key
<code>HKLM\SOFTWARE\WOW6432Node\Gallagher\Command Centre</code>, set to one by the installer.  Change its value
to zero to stop the logging.  You do not need to restart Command Centre.</p>
</div>
<div class="paragraph">
<p>9.00 servers and later truncate URLs if they are too long.  This is controlled by a DWORD in the
registry called <code>LogRESTURLMaxLength</code>:  if a URL has more characters in it than that, it will be
truncated.  The default is 200.  Zero suppresses URLs altogether.  If you want your URLs to go into
the log unmolested, set it to a high value (such as four billion).</p>
</div>
<div class="paragraph">
<p>The default file name is <code>RESTAccess.log</code> and the file will appear in the same folder as the
server&#8217;s licence and other logs.  NLog will rotate it once per day by adding a time stamp to its
name.  After ten days it will delete it.  There is no limit to the size of the file.  Those settings
are in the server&#8217;s application config, but we advise against changing them as doing so may affect
our ability to offer technical support.  Also, your changes may not survive an upgrade.  Also, a
syntax error in the app config will prevent Command Centre from starting.</p>
</div>
<div class="paragraph">
<p>The default file format is JSON, for easy consumption by the popular log aggregation platforms.
Each request will be on one line.  Here is an example busted out and indented for easier reading:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="json-doc"><span class="p">{</span><span class="w">
  </span><span class="nl">"request_time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2022-12-02T03:41:52.5732150Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ip"</span><span class="p">:</span><span class="w">           </span><span class="s2">"127.0.0.1"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"client"</span><span class="p">:</span><span class="w">       </span><span class="s2">"REST Client item name"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"method"</span><span class="p">:</span><span class="w">       </span><span class="s2">"GET"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"url"</span><span class="p">:</span><span class="w">          </span><span class="s2">"/api/events?top=9999"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w">       </span><span class="mi">200</span><span class="p">,</span><span class="w">
  </span><span class="nl">"elapsed_ms"</span><span class="p">:</span><span class="w">   </span><span class="mi">502</span><span class="p">,</span><span class="w">
  </span><span class="nl">"endpoint"</span><span class="p">:</span><span class="w">     </span><span class="s2">"api/events"</span><span class="w">
</span><span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>request_time</code> was the time when the API call arrived, but the log line goes to disk when the call
finishes, so it will not always be an increasing value.  A long poll, for example, may be logged 50
seconds after it was requested, by which time many other (quicker) calls may have started, finished,
and been logged.</p>
</div>
<div class="paragraph">
<p><code>endpoint</code> will be null (missing, actually) if the web server couldn&#8217;t find a route to service the
request.  The status of that will be a 404.  Somebody didn&#8217;t read <a href="#_the_importance_of_api">about the importance of <code>/api</code></a>.</p>
</div>
<div class="paragraph">
<p>The format of this file, plus its name and rotation policy, are yours to configure via the
application config file.  There is an example in there of how to produce a format closer to the
Apache common log format.  However:</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
Contact Gallagher Technical Support with your wishes before editing Command Centre&#8217;s
configuration file.  It is large and complex and if you get it wrong, the server will not start.
Worse, it may start but then not behave as you expect.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix-privtable"><a class="link" href="#appendix-privtable">Appendix: Privilege table</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is not the complete list of privileges! See the topic 'Which Operator Privileges
you require' in the Configuration Client’s online help for more.</p>
</div>
<div class="paragraph">
<p>Remember that privileges lie on divisions, not on items, so when this
table says you need a privilege on some item, take it to mean that you
need that privilege on the division containing that item, or (because
every division inherits the privileges of its parent) one of that
division’s ancestors.</p>
</div>
<div class="paragraph">
<p>'Advanced User' grants nearly all privileges, so I don&#8217;t mention it here.</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Goal</th>
<th class="tableblock halign-left valign-top">Privileges required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View cardholder data at <code>/api/cardholders</code> and <code>/api/cardholders/id</code> except notes and operator
fields.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Cardholder' or any of the privileges that allow editing a cardholder, on the cardholder’s
division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View all cardholder data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Cardholder' or any of the cardholder editing privileges on the cardholder’s division, plus
'View Cardholder Notes' reveals notes, and 'View Lockers and Assignments' adds locker detail.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View cardholder PDF values</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Cardholder' or any of the cardholder editing privileges on the cardholder’s division, plus
your operator group needs to give you 'view' or 'edit' access to the PDF, or the PDF&#8217;s default
privilege must be 'view' or 'edit'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create cardholders, but not modify them.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Create Cardholders' on the cardholder’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create and edit cardholders, except their notes and operator settings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Create and Edit Cardholders' on the cardholder’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit cardholders, except their notes and operator settings.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit Cardholders' on the cardholder’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit cardholder notes.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the privileges that lets you edit cardholders as well as either of 'Add Cardholder Notes' or
'Edit Cardholder Notes' on the cardholder’s division. It is different in the thick clients: there,
one of the last two is enough.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modify cardholder access group memberships.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the privileges that lets you edit cardholders on the cardholder’s division plus 'Modify
Access Control' on the group’s division. 'Modify Access Control' on the group’s division is enough
in the thick clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change a cardholder’s location.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Cardholder' on the cardholder, and 'Manage Cardholder Location' on the target access zone’s
division, when you are moving the cardholder into an access zone, otherwise any division, when you
are moving the cardholder outside the system.  By the way: collecting access zones normally requires
the RESTStatus licence, but there is a variant of that call that returns just the zones your
operator is allowed to move cardholders to that only requires the RESTCardholders licence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assign a card to a cardholder.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the privileges that lets you edit cardholders ('Create' or 'Create and Edit') on the
cardholder’s division and on the card type’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View assignable card types at <code>/api/card_types/assign</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the 'Edit Cardholder' privileges on the card type’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View card types at '/api/card_types'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Site' or 'Configure Site' on the card type’s division. The privileges that let you create or
edit cardholders also reveal PIV types.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change locker assignments.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A privilege that lets you edit cardholders on the cardholder’s division plus 'Manage
Locker Assignments' on the locker’s division. 'Manage Locker Assignments' on the locker’s division
is enough in the thick clients.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable a card.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the privileges that lets you edit cardholders on the cardholder’s division. The 'Disable
Card' privilege has no effect on current versions of the REST API. In the thick clients you do not
need edit privileges on the cardholder if you have 'Disable Card'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change a card&#8217;s PIN.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Allow re-printing and re-encoding" or "Print/preview &amp; encode card" or "Edit cardholders" or one
of the privileges that let you edit a cardholder (which in 8.90 are "Edit cardholders" and "create and edit cardholders").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">De-authorise a cardholder.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'De-authorise Cardholder' or one of the privileges that lets you edit cardholders on the
cardholder’s division.  There is a bug in versions up to and including 8.70 that means you need
'Edit Cardholders' to de-authorise a cardholder.  'De-authorise Cardholder' works on its own in 8.80
and later.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete a cardholder.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Delete cardholders' on the cardholder&#8217;s division.  Not 'Create Cardholders', 'Create and Edit
 Cardholder', or 'Edit Cardholder'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redact a cardholder&#8217;s events.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Delete Cardholder History' on the cardholder&#8217;s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redact a cardholder.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Delete Cardholder History' and 'Delete Cardholders' on the cardholder&#8217;s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit a relationship between cardholders.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One of the privileges that lets you edit cardholders on the cardholder’s division and on the role’s
division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View a cardholder’s operator configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Operators' or one of the privileges that let you modify an operator, such as 'Edit Operators'
or 'Enable/Disable Operator'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View operator groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit Operator Groups' or 'View Operator Groups'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change a cardholder’s operator groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Modify Operator Group Membership'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View PDF definitions at <code>/api/personal_data_fields</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View…' or 'Edit Personal Data Definitions' on the PDF’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View events at <code>/api/events</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Events and Alarms' or any of the privileges that allow processing alarms, on the division of
the event or alarm.<br>
Or (in 8.70) 'View Cardholder Events' on the division of the cardholder related to the event and on
the event&#8217;s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acknowledge, process, or mark alarms as viewed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit Alarms' on division of the event or alarm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create new events (8.10+)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Create Events and Alarms' on the division of the source of the event, if the source is not your
 REST Client item, or any division otherwise.  Prior to 8.90 having it on any division was enough
 (bug).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List access groups.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Access Groups' or 'Edit Access Groups' on the access group’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List competencies.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Site' or 'Edit Site'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receive schedule hrefs in an access group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Schedules' on the schedule’s division. 'View Site', 'Configure Site', and 'Edit Site' will
not do it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List access zones and receive their hrefs in other results</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit Site', 'View Site', or 'Override' on the access zone’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override an access zone’s mode.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Override' on the zone’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List alarm zones</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit site', 'View Site', or 'Override' on the alarm zone’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List doors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit site', 'View Site', or 'Override - Open Door' on the door’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override doors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Override - Open Door' on the door’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List fence zones</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit site', 'View Site', or 'Maintenance Override' on the fence zone’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override fence zones</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Maintenance override' on the fence zone’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List inputs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit Site', 'View Site', 'Maintenance Override' on the input’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List macros</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Site', 'Run Macros', or 'Schedule and Run Macros' on the macro’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List outputs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit site', 'View site', or 'Override' on the output’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List day categories</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Configure Site', 'Edit Schedules', 'View Site'.  Day categories are divisionless, so having one of
those privs on any division is enough. 'View Schedules' is true to its word: it will not show you
day categories.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List schedules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Schedules', 'Edit Schedules', 'Schedule Access Zone' (though the last one only gives you
access to access zone schedules, not the other five types).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create, edit, and delete schedules.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit Schedules'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List elevator groups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit Passenger Details' is probably the one you want. 'View Site' lets you see elevator groups, but
might not let you use them on a cardholder.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set a cardholder’s default floors (for calling elevators)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit Passenger Details'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run a macro at '/api/macros/id/run'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Run Macros' or 'Schedule &amp; Run Macros' on the macro’s division.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shunt or unshunt an item.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Maintenance Override' on the item’s division. 'Override', which is good for most other overrides,
is not enough to shunt or unshunt an item.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View a division’s visitor management configuration, and view receptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View Site', 'Edit Site', 'View Visits', 'Edit Visits', or 'Manage Receptions'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View a visit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'View' or 'Edit Visits'. 'Manage Receptions' will not do it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modify a visit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Edit Visits'. 'Manage Receptions' will not do this either.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modify a division</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'Configure Site' or 'Edit Enterprise Data Interfaces' on the division itself.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="appendix-features"><a class="link" href="#appendix-features">Appendix: Features and licences</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_alarms_and_events"><a class="link" href="#_alarms_and_events">Alarms and events</a></h3>
<div class="paragraph">
<p>7.80 allows reading and writing unprocessed alarms. Clients can read all
their fields, mark them as viewed, add comments, acknowledge, and
ultimately process them.</p>
</div>
<div class="paragraph">
<p>7.80 allows reading events. Clients can see all fields, including these
related items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cardholder, entry/exit zone, division,</p>
</li>
<li>
<p>(in 8.00) the source item, and the operator and access group on
head-end events (i.e., those that did not come from a controller),</p>
</li>
<li>
<p>(in 8.30) the door on guard tour events, and</p>
</li>
<li>
<p>(in 8.40) the item that an operator modified.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At time of writing (8.30), the following are absent from the list of items related to an
event: locker bank and locker, door (unless it is a guard tour event),
missing competency, car park, and car park space. In practice that is
rarely a problem since those items are often the event’s source, and
will therefore be in the source block.</p>
</div>
<div class="paragraph">
<p>You need RESTEvents in your licence for all the above.</p>
</div>
<div class="paragraph">
<p>8.10 allows creating external events with the RESTCreateEvents licence.
Clients can use the usual item types as the source of the event and can
attach one of each of these as related items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cardholders,</p>
</li>
<li>
<p>operators,</p>
</li>
<li>
<p>entry access zones,</p>
</li>
<li>
<p>access groups,</p>
</li>
<li>
<p>lockers and locker banks, and</p>
</li>
<li>
<p>doors.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_cardholders_and_supporting_items"><a class="link" href="#_cardholders_and_supporting_items">Cardholders and supporting items</a></h3>
<div class="paragraph">
<p>7.90 allows most administrative functions on cardholders, including full
credential maintenance.</p>
</div>
<div class="paragraph">
<p>It also gives read-only access to supporting items:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>access groups,</p>
</li>
<li>
<p>competencies,</p>
</li>
<li>
<p>card types,</p>
</li>
<li>
<p>roles,</p>
</li>
<li>
<p>lockers,</p>
</li>
<li>
<p>(in 8.10) PDF definitions,</p>
</li>
<li>
<p>(in 8.50) default elevator floors, and operator privileges.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>8.20 allows moving cardholders between access zones. To support that it
added a call to the access zones controller that requires the
cardholders licence, not RESTStatus as the other access zone calls do.</p>
</div>
<div class="paragraph">
<p>8.30 allows subscribing to cardholder changes, for integrations that use
Command Centre as a source of users.</p>
</div>
<div class="paragraph">
<p>8.40 shows an access group’s access zones, Salto items, and privileges
(there are 20). In the Access Group window in the Configuration Client
these are the 'Access', 'Salto Access', and 'Privileges' tabs. These are
all read-only fields.</p>
</div>
<div class="paragraph">
<p>8.50 adds views of operator groups, receptions, and visitor management
settings, and read-write access to visits and cardholders’ operator and
elevator settings.</p>
</div>
<div class="paragraph">
<p>8.80 adds cardholder redaction:  scrubbing a person&#8217;s activity and identifying information out of
the database to help with privacy protection regulations.</p>
</div>
<div class="paragraph">
<p>Car parks remain on the roadmap.</p>
</div>
<div class="paragraph">
<p>These cardholder functions require the RESTCardholders licence. 8.20
added lockers and locker banks to the RESTStatus licence as well, minus
the cardholder information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_non_cardholder_items"><a class="link" href="#_non_cardholder_items">Non-cardholder items</a></h3>
<div class="paragraph">
<p>8.00 allows read access to basic configuration, status, and all
overrides, to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>access zones, alarm zones, and fence zones,</p>
</li>
<li>
<p>doors,</p>
</li>
<li>
<p>macros, and</p>
</li>
<li>
<p>outputs and (in 8.10) inputs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will need the RESTStatus licence for the GETs and RESTOverrides for
the override POSTs. 8.60 added the GETs to RESTOverrides, but in a
slightly limited way: they will search for items to override, but they
cannot return their status.</p>
</div>
<div class="paragraph">
<p>8.20 added lockers, previously only visible with the RESTCardholders
licence, to the RESTStatus licence.</p>
</div>
<div class="paragraph">
<p>8.30 added the ability to monitor more than one item per connection.</p>
</div>
<div class="paragraph">
<p>8.50 allows read access to day categories and read-write access to
schedules. You can manage the day categories and times on a schedule,
but not which items it affects.</p>
</div>
<div class="paragraph">
<p>Day categories are divisionless, which led to a slight change in the
<code>/items</code> controller: divisionless items did not appear there before
8.50; now they do (subject to privilege checks, of course).</p>
</div>
<div class="paragraph">
<p>8.50 allows viewing elevator groups.</p>
</div>
<div class="paragraph">
<p>As of 8.60, cardholders, schedules, and visits are the only items you
can modify via the API.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-12-01 04:39:53 UTC
</div>
</div>
</body>
</html>